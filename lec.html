<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lectures</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“š</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Hind Siliguri', sans-serif;
    -webkit-tap-highlight-color: transparent;
}

body {
    background: #0a0a0a;
    color: #ffffff;
    line-height: 1.6;
    min-height: 100vh;
    padding-bottom: 20px;
    position: relative;
    padding-top: 120px; /* Account for fixed header */
}

body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 10% 20%, rgba(26, 26, 46, 0.5) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(15, 52, 96, 0.4) 0%, transparent 20%),
        radial-gradient(circle at 50% 50%, rgba(22, 33, 62, 0.3) 0%, transparent 30%);
    z-index: -1;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 15px;
}

/* Header Styles */
.header {
    background: rgba(15, 15, 20, 0.9);
    color: #ffffff;
    padding: 15px 0;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000;
}

.header-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.header::before {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 5%;
    width: 90%;
    height: 10px;
    background: rgba(255, 255, 255, 0.05);
    filter: blur(10px);
    border-radius: 50%;
}

.back-button {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    font-size: 24px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

.back-button:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

.logo-container {
    display: flex;
    align-items: center;
    justify-content: center;
    flex: 1;
}

.logo-text {
    font-size: 42px;
    font-weight: 700;
    color: #ffffff;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
    margin-left: 15px;
    display: flex;
    align-items: center;
}

.logo-text i {
    margin-right: 15px;
    font-size: 36px;
}

/* Main Content Layout */
.main-content {
    display: flex;
    gap: 30px;
    margin-bottom: 30px;
}

.video-section {
    flex: 2;
    background: rgba(20, 20, 30, 0.6);
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
    animation: fadeIn 0.5s ease;
    height: 500px;
    display: flex;
    flex-direction: column;
}

.video-section::before {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 5%;
    width: 90%;
    height: 10px;
    background: rgba(255, 255, 255, 0.05);
    filter: blur(10px);
    border-radius: 50%;
}

.video-container {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
    overflow: hidden;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    background: #000;
    flex-shrink: 0;
}

/* Fix video container for fullscreen */
#player-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.video-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
}

.video-info {
    display: flex;
    align-items: center;
    margin-top: 20px;
    padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    border-left: 4px solid rgba(255, 255, 255, 0.3);
    animation: slideIn 0.5s ease;
    font-size: 18px;
    font-weight: 600;
    text-align: left;
    justify-content: flex-start;
}

/* Subjects Section */
.subjects-section {
    flex: 1;
    background: rgba(20, 20, 30, 0.6);
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
    height: 500px;
    display: flex;
    flex-direction: column;
}

.subjects-section::before {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 5%;
    width: 90%;
    height: 10px;
    background: rgba(255, 255, 255, 0.05);
    filter: blur(10px);
    border-radius: 50%;
}

.section-title {
    font-size: 28px;
    font-weight: 700;
    color: #ffffff;
    margin-bottom: 10px;
    text-align: center;
    position: relative;
    padding-bottom: 10px;
    flex-shrink: 0;
}

.section-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 3px;
    background: linear-gradient(to right, rgba(255, 255, 255, 0.7), rgba(160, 174, 192, 0.7));
    border-radius: 3px;
}

.pcmb-timer {
    text-align: center;
    color: #ff4d4d;
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 15px;
    background: rgba(255, 77, 77, 0.1);
    padding: 5px 10px;
    border-radius: 5px;
    border: 1px solid rgba(255, 77, 77, 0.3);
    flex-shrink: 0;
}

.subjects-container {
    flex: 1;
    overflow-y: auto;
    padding-right: 5px;
}

.subjects-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.subject-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.subject-header {
    display: flex;
    align-items: center;
    padding: 15px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.subject-header:hover {
    background: rgba(255, 255, 255, 0.08);
}

.subject-icon {
    font-size: 24px;
    margin-right: 15px;
    width: 30px;
    text-align: center;
}

.subject-title {
    font-size: 20px;
    font-weight: 600;
    flex-grow: 1;
}

.dropdown-icon {
    font-size: 16px;
    transition: transform 0.3s ease;
}

.badge-container {
    display: flex;
    gap: 5px;
    margin-right: 10px;
}

.badge {
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    font-weight: 700;
    text-transform: uppercase;
}

.badge-new {
    background: #ff4d4d;
    color: white;
}

.badge-24h {
    background: #4d79ff;
    color: white;
}

.limited-time-icon {
    color: #ff4d4d;
    font-size: 16px;
    margin-left: 5px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.lectures-list {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    background: rgba(10, 10, 15, 0.5);
}

.lectures-list.open {
    max-height: 300px;
    overflow-y: auto;
}

.lecture-item {
    display: flex;
    align-items: center;
    padding: 12px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    position: relative;
}

.lecture-item:last-child {
    border-bottom: none;
}

.lecture-item:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateX(5px);
}

.lecture-item.active {
    background: rgba(76, 175, 80, 0.2);
    border-left: 4px solid #4CAF50;
}

.lecture-icon {
    font-size: 20px;
    margin-right: 15px;
    width: 25px;
    text-align: center;
}

.lecture-title {
    font-size: 16px;
    font-weight: 500;
    flex-grow: 1;
}

.lecture-badges {
    display: flex;
    gap: 5px;
    margin-left: 10px;
    align-items: center;
}

/* Plyr Override Styles */
.plyr {
    border-radius: 12px;
    overflow: hidden;
}

.plyr--video {
    border-radius: 12px;
}

/* Fix Plyr fullscreen styles */
.plyr--fullscreen-active {
    border-radius: 0 !important;
}

.plyr--fullscreen-active .plyr__video-wrapper {
    height: 100vh !important;
    width: 100vw !important;
}

/* Custom Plyr controls for skip buttons */
.plyr__controls button.plyr__control--rewind,
.plyr__controls button.plyr__control--fast-forward {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    color: white;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.plyr__controls button.plyr__control--rewind:hover,
.plyr__controls button.plyr__control--fast-forward:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
}

@media (max-width: 768px) {
    .plyr--video .plyr__controls {
        padding: 10px 5px;
    }
    
    .plyr__controls .plyr__control {
        margin: 0 2px;
    }
    
    .plyr__time {
        font-size: 12px;
    }
    
    .plyr__menu__container {
        bottom: 60px;
    }
}

/* Custom Video Player Styles */
.custom-player-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.custom-player {
    width: 100%;
    height: 100%;
    background: #000;
    border-radius: 12px;
    overflow: hidden;
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideIn {
    from { transform: translateY(10px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

@keyframes scaleIn {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

/* Responsive Design */
@media (max-width: 992px) {
    .main-content {
        flex-direction: column;
    }
    
    .video-section, .subjects-section {
        height: auto;
    }
    
    .subjects-section {
        max-height: 500px;
    }
}

@media (max-width: 768px) {
    body {
        padding-top: 110px;
    }
    
    .logo-text {
        font-size: 36px;
    }
    
    .logo-text i {
        font-size: 30px;
    }
    
    .video-info {
        font-size: 16px;
    }
    
    .section-title {
        font-size: 24px;
    }
    
    .subject-title {
        font-size: 18px;
    }
    
    .lecture-title {
        font-size: 15px;
    }
}

@media (max-width: 480px) {
    body {
        padding-top: 100px;
    }
    
    .logo-text {
        font-size: 28px;
    }
    
    .logo-text i {
        font-size: 24px;
        margin-right: 10px;
    }
    
    .video-section, .subjects-section {
        padding: 20px;
    }
    
    .section-title {
        font-size: 22px;
    }
    
    .subject-header {
        padding: 12px 15px;
    }
    
    .subject-title {
        font-size: 16px;
    }
    
    .lecture-item {
        padding: 10px 15px;
    }
    
    .lecture-title {
        font-size: 14px;
    }
    
    .badge {
        font-size: 9px;
        padding: 1px 4px;
    }
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(20, 20, 30, 0.5);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.5), rgba(160, 174, 192, 0.5));
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, rgba(160, 174, 192, 0.5), rgba(255, 255, 255, 0.5));
}

/* Placeholder for empty video */
.video-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: #aaa;
    font-size: 18px;
    background: #000;
    border-radius: 12px;
    z-index: 2;
}

.video-placeholder i {
    font-size: 48px;
    margin-bottom: 15px;
}

/* Hide player when placeholder is shown */
#player {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
}

/* Transparent overlay to block iframe interaction */
.iframe-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10;
    background: transparent;
    cursor: default;
    pointer-events: none; /* Default: allow clicks to pass through */
}

/* Enable overlay blocking when video is playing */
.plyr--playing .iframe-overlay {
    pointer-events: auto; /* Block clicks when video is playing */
}

/* Fixed fullscreen overlay positioning */
.plyr--fullscreen-active .iframe-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 9999;
}

/* Make sure custom player controls are always accessible */
.plyr__controls {
    z-index: 20 !important;
    position: relative;
    pointer-events: auto !important;
}

.plyr__control {
    z-index: 21 !important;
    position: relative;
    pointer-events: auto !important;
}


@media (max-width: 768px) {
    /* Plyr Player Control Icons */
    .plyr__control {
        transform: scale(0.9);
    }
    
    .plyr__control--overlaid {
        transform: scale(0.8);
    }
    
    .plyr__controls button {
        padding: 8px;
    }
    
    .plyr__controls button svg {
        width: 16px;
        height: 16px;
    }
    
    .plyr__control--rewind,
    .plyr__control--fast-forward {
        padding: 6px;
    }
    
    .plyr__control--rewind svg,
    .plyr__control--fast-forward svg {
        width: 14px;
        height: 14px;
    }
    
    .plyr__menu__container .plyr__control svg {
        width: 14px;
        height: 14px;
    }
}

@media (max-width: 480px) {
    /* Smaller icons for small mobile screens */
    .plyr__control {
        transform: scale(0.8);
    }
    
    .plyr__control--overlaid {
        transform: scale(0.7);
    }
    
    .plyr__controls button {
        padding: 6px;
    }
    
    .plyr__controls button svg {
        width: 14px;
        height: 14px;
    }
    
    .plyr__control--rewind,
    .plyr__control--fast-forward {
        padding: 5px;
    }
    
    .plyr__control--rewind svg,
    .plyr__control--fast-forward svg {
        width: 12px;
        height: 12px;
    }
    
    .plyr__time {
        font-size: 11px;
    }
    
    .plyr__menu__container .plyr__control svg {
        width: 12px;
        height: 12px;
    }
}

@media (max-width: 360px) {
    /* Even smaller icons for compact mobile screens */
    .plyr__control {
        transform: scale(0.75);
    }
    
    .plyr__control--overlaid {
        transform: scale(0.65);
        padding: 12px;
    }
    
    .plyr__controls button {
        padding: 5px;
    }
    
    .plyr__controls button svg {
        width: 13px;
        height: 13px;
    }
    
    .plyr__control--rewind,
    .plyr__control--fast-forward {
        padding: 4px;
    }
    
    .plyr__control--rewind svg,
    .plyr__control--fast-forward svg {
        width: 11px;
        height: 11px;
    }
    
    .plyr__time {
        font-size: 10px;
        margin: 0 3px;
    }
    
    .plyr__menu__container .plyr__control svg {
        width: 11px;
        height: 11px;
    }
    
    .plyr__volume {
        min-width: 60px;
    }
}

@media (max-width: 320px) {
    /* Minimal icons for very small screens (iPhone SE, etc.) */
    .plyr__control {
        transform: scale(0.7);
    }
    
    .plyr__control--overlaid {
        transform: scale(0.6);
        padding: 10px;
    }
    
    .plyr__controls button {
        padding: 4px;
    }
    
    .plyr__controls button svg {
        width: 12px;
        height: 12px;
    }
    
    .plyr__control--rewind,
    .plyr__control--fast-forward {
        padding: 3px;
        margin: 0 2px;
    }
    
    .plyr__control--rewind svg,
    .plyr__control--fast-forward svg {
        width: 10px;
        height: 10px;
    }
    
    .plyr__time {
        font-size: 9px;
        margin: 0 2px;
    }
    
    .plyr__menu__container .plyr__control svg {
        width: 10px;
        height: 10px;
    }
    
    .plyr__volume {
        min-width: 50px;
    }
    
    .plyr__controls__item {
        margin: 0 2px;
    }
}

@media (max-width: 280px) {
    /* Ultra-compact for smallest devices */
    .plyr__control {
        transform: scale(0.65);
    }
    
    .plyr__control--overlaid {
        transform: scale(0.55);
        padding: 8px;
    }
    
    .plyr__controls button {
        padding: 3px;
    }
    
    .plyr__controls button svg {
        width: 11px;
        height: 11px;
    }
    
    .plyr__control--rewind,
    .plyr__control--fast-forward {
        padding: 2px;
        margin: 0 1px;
    }
    
    .plyr__control--rewind svg,
    .plyr__control--fast-forward svg {
        width: 9px;
        height: 9px;
    }
    
    .plyr__time {
        font-size: 8px;
        margin: 0 1px;
    }
    
    .plyr__menu__container .plyr__control svg {
        width: 9px;
        height: 9px;
    }
    
    .plyr__volume {
        min-width: 45px;
        display: none; /* Hide volume on ultra-small screens */
    }
    
    .plyr__controls__item {
        margin: 0 1px;
    }
}
/* Mobile Touch Controls - FIXED */
.plyr--touch .plyr__controls {
    transition: all 0.3s ease;
    opacity: 1;
    transform: translateY(0);
}

.plyr--touch .plyr__controls.hidden {
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
}

/* Touch overlay for mobile - FIXED */
.touch-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 16; /* Above double-tap overlay (15) but below controls (20+) */
    background: transparent;
    display: block; /* Always show when created */
    cursor: pointer;
    pointer-events: auto; /* Always accept touch events */
}

.plyr--touch .touch-overlay {
    display: block;
}

/* Ensure touch overlay works in fullscreen */
.plyr--fullscreen-active .touch-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 16;
}

/* Improved hover effects for desktop */
@media (hover: hover) {
    .subject-header:hover {
        background: rgba(255, 255, 255, 0.12);
        transform: translateY(-1px);
    }
    
    .lecture-item:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(8px);
    }
    
    .back-button:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px) scale(1.05);
    }
}

/* Touch-specific styles */
@media (hover: none) {
    .subject-header:active {
        background: rgba(255, 255, 255, 0.15);
        transform: scale(0.98);
    }
    
    .lecture-item:active {
        background: rgba(255, 255, 255, 0.12);
        transform: scale(0.98);
    }
    
    .back-button:active {
        background: rgba(255, 255, 255, 0.25);
        transform: scale(0.95);
    }
}

/* Ensure controls are always accessible */
.plyr__menu__container {
    z-index: 25 !important;
}

.plyr__menu__container .plyr__control {
    z-index: 26 !important;
}

/* Double Tap Visual Feedback - FIXED */
.double-tap-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: space-between;
    pointer-events: none;
    z-index: 10;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.double-tap-overlay.active {
    opacity: 1;
}

.double-tap-overlay .seek-backward,
.double-tap-overlay .seek-forward {
    width: 50%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 14px;
    font-weight: 600;
    background: rgba(0, 0, 0, 0.7);
    opacity: 0;
    transform: scale(0.8);
    transition: all 0.3s ease;
}

.double-tap-overlay.active .seek-backward.show,
.double-tap-overlay.active .seek-forward.show {
    opacity: 1;
    transform: scale(1);
}

.double-tap-overlay .seek-backward svg,
.double-tap-overlay .seek-forward svg {
    margin-bottom: 8px;
    width: 32px;
    height: 32px;
}

/* Loading indicator */
.video-loading {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.7);
    z-index: 20;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.video-loading.active {
    opacity: 1;
    pointer-events: auto;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Error state */
.video-error {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.9);
    z-index: 30;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.video-error.active {
    opacity: 1;
    pointer-events: auto;
}

.error-content {
    text-align: center;
    color: white;
    max-width: 80%;
}

.error-content svg {
    margin-bottom: 16px;
    color: #ff6b6b;
}

.error-content h3 {
    margin-bottom: 8px;
    font-size: 18px;
}

.error-content p {
    margin-bottom: 20px;
    opacity: 0.8;
}

.retry-button {
    background: #4a90e2;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.2s ease;
}

.retry-button:hover {
    background: #3a7bc8;
}

/* Fullscreen adjustments */
.plyr--fullscreen-active .double-tap-overlay,
.plyr--fullscreen-active .video-loading,
.plyr--fullscreen-active .video-error {
    position: fixed;
    z-index: 9999;
}

/* Mobile optimizations */
@media (max-width: 768px) {
    .double-tap-overlay .seek-backward,
    .double-tap-overlay .seek-forward {
        font-size: 12px;
    }
    
    .double-tap-overlay .seek-backward svg,
    .double-tap-overlay .seek-forward svg {
        width: 24px;
        height: 24px;
    }
    
    /* Ensure touch targets are at least 44px for accessibility */
    .plyr__control {
        min-width: 44px;
        min-height: 44px;
    }
}

/* Prevent YouTube controls from interfering */
.plyr__video-embed iframe {
    pointer-events: auto;
}

.plyr--playing .plyr__video-embed iframe {
    pointer-events: none;
}

/* Double tap animation */
@keyframes doubleTapPulse {
    0% { transform: scale(0.8); opacity: 0; }
    50% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(1); opacity: 0.8; }
}

.double-tap-indicator.pulse {
    animation: doubleTapPulse 0.4s ease-out;
}

/* Make sure double-tap overlay is properly positioned */
.plyr--fullscreen-active .double-tap-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 15; /* Keep below controls in fullscreen too */
}

/* Ensure Plyr controls are always above everything */
.plyr__controls {
    z-index: 20 !important;
}

.plyr__control {
    z-index: 21 !important;
}

.plyr__menu__container {
    z-index: 25 !important;
}
</style>
</head>
<body>
    <!-- Fixed Header -->
    <header class="header">
        <div class="header-content">
            <button class="back-button" onclick="goToHome()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="logo-container">
                <div class="logo-text">
                    <i class="fas fa-chalkboard-teacher"></i>
                    Classroom
                </div>
            </div>
            <div style="width: 50px;"></div> <!-- Spacer for alignment -->
        </div>
    </header>

    <div class="container">
        <div class="main-content">
<!-- Video Player Section -->
<section class="video-section">
    <div class="video-container">
        <div id="player-container">
            <div id="video-placeholder" class="video-placeholder">
                <i class="fas fa-play-circle"></i>
                <p>Select a lecture to begin</p>
            </div>
            <div id="player" class="plyr__video-embed" style="display: none;">
                <!-- Double Tap Overlay for Mobile - FIXED -->
                <div class="double-tap-overlay" id="double-tap-overlay">
                    <div class="seek-backward" id="seek-backward">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M11 9L8 12L11 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M16 9L13 12L16 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>10s</span>
                    </div>
                    <div class="seek-forward" id="seek-forward">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M13 9L16 12L13 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M8 9L11 12L8 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>10s</span>
                    </div>
                </div>
                
                <!-- Loading indicator -->
                <div class="video-loading" id="video-loading">
                    <div class="loading-spinner"></div>
                </div>
                
                <!-- Error state -->
                <div class="video-error" id="video-error">
                    <div class="error-content">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 8V12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <h3>Video Failed to Load</h3>
                        <p>Please check your connection and try again.</p>
                        <button class="retry-button" id="retry-button">Retry</button>
                    </div>
                </div>
                
                <!-- Transparent overlay to block iframe interaction -->
                <div class="iframe-overlay" id="iframe-overlay"></div>
                <iframe 
                    id="lecture-video" 
                    src="" 
                    frameborder="0" 
                    allowfullscreen
                    allow="autoplay"
                ></iframe>
            </div>
        </div>
    </div>
    <div class="video-info">
        <span id="lecture-name">Select a lecture to begin</span>
    </div>
</section>

            <!-- Subjects Section -->
            <section class="subjects-section">
                <h2 class="section-title">Subjects</h2>
                <div class="pcmb-timer" id="pcmb-timer">
                    PCMB Time Left: Calculating...
                </div>
                <div class="subjects-container">
                    <div class="subjects-list" id="subjects-list">
                        <!-- Subjects will be populated by JavaScript -->
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Plyr JS -->
    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <script src="data/cache1.js"></script>
    <script>
class CustomVideoPlayer {
    constructor() {
        this.player = null;
        this.isInitialized = false;
        this.isLoading = false;
        this.hasError = false;
        this.activeLecture = null;
        this.pendingVideoRequest = null;
        
        // Double-tap detection
        this.lastTap = 0;
        this.tapTimeout = null;
        this.tapDelay = 300; // ms
        
        // Controls visibility
        this.controlsTimeout = null;
        this.controlsVisible = true;
        this.controlsHideDelay = 3000; // ms
        
        // Touch detection
        this.isTouchDevice = this.detectTouchDevice();
        
        // DOM Elements
        this.elements = {
            subjectsList: document.getElementById('subjects-list'),
            videoFrame: document.getElementById('lecture-video'),
            lectureNameElement: document.getElementById('lecture-name'),
            pcmbTimerElement: document.getElementById('pcmb-timer'),
            videoPlaceholder: document.getElementById('video-placeholder'),
            playerContainer: document.getElementById('player'),
            doubleTapOverlay: document.getElementById('double-tap-overlay'),
            videoLoading: document.getElementById('video-loading'),
            videoError: document.getElementById('video-error'),
            retryButton: document.getElementById('retry-button')
        };
        
        this.init();
    }
    
    init() {
        if (this.isInitialized) {
            this.destroy();
        }
        
        this.initializeNewLectureTracking();
        this.populateSubjects();
        this.updatePCMBTimer();
        this.setupOverlayProtection();
        this.setupEventListeners();
        
        setInterval(() => this.updatePCMBTimer(), 60000);
        window.addEventListener('resize', () => this.updateOverlayPosition());
        
        if (this.isTouchDevice) {
            setTimeout(() => this.initializeDoubleTapDetection(), 1000);
        }
        
        this.isInitialized = true;
    }
    
    // Touch device detection
    detectTouchDevice() {
        return (('ontouchstart' in window) || 
                (navigator.maxTouchPoints > 0) || 
                (navigator.msMaxTouchPoints > 0) ||
                (window.DocumentTouch && document instanceof DocumentTouch));
    }
    
    // Double Tap Detection
    initializeDoubleTapDetection() {
        if (!this.isTouchDevice) return;
        
        console.log('Double tap detection initialized');
        this.setupDoubleTapEventListeners();
    }
    
    setupDoubleTapEventListeners() {
        if (!this.isTouchDevice) return;
        
        const videoWrapper = document.querySelector('.plyr__video-wrapper');
        if (!videoWrapper) return;
        
        // Remove existing listeners first to avoid duplicates
        videoWrapper.removeEventListener('touchstart', this.handleTap.bind(this));
        videoWrapper.removeEventListener('touchend', this.handleTapEnd.bind(this));
        
        // Add new listeners
        videoWrapper.addEventListener('touchstart', this.handleTap.bind(this), { passive: true });
        videoWrapper.addEventListener('touchend', this.handleTapEnd.bind(this), { passive: false });
        
        console.log('Double tap event listeners setup');
    }
    
    handleTap(event) {
        if (!this.isTouchDevice || !this.player) return;
        
        event.stopPropagation();
        
        const rect = this.elements.playerContainer.getBoundingClientRect();
        const tapX = event.changedTouches ? event.changedTouches[0].clientX : event.clientX;
        const tapPosition = (tapX - rect.left) / rect.width;
        
        const currentTime = new Date().getTime();
        const timeDiff = currentTime - this.lastTap;
        
        if (timeDiff < this.tapDelay && timeDiff > 0) {
            // Double tap detected
            event.preventDefault();
            clearTimeout(this.tapTimeout);
            this.lastTap = 0;
            this.handleDoubleTap(tapPosition < 0.5 ? 'left' : 'right');
        } else {
            // Single tap - set timeout
            this.tapTimeout = setTimeout(() => {
                this.handleSingleTap();
                this.lastTap = 0;
            }, this.tapDelay);
            this.lastTap = currentTime;
        }
        
        // Show controls on any tap
        this.showControls();
    }
    
    handleTapEnd(event) {
        if (!this.isTouchDevice) return;
        event.preventDefault();
    }
    
    handleSingleTap() {
        // Toggle play/pause on single tap
        if (this.player) {
            if (this.player.playing) {
                this.player.pause();
            } else {
                this.player.play();
            }
        }
    }
    
    handleDoubleTap(section) {
        if (!this.player || this.player.duration === 0) return;
        
        // Show visual feedback
        this.showSeekFeedback(section === 'left');
        
        // Seek forward or backward
        const currentTime = this.player.currentTime;
        const seekAmount = 10; // seconds
        
        if (section === 'left') {
            this.player.currentTime = Math.max(0, currentTime - seekAmount);
        } else {
            this.player.currentTime = Math.min(this.player.duration, currentTime + seekAmount);
        }
    }
    
    showSeekFeedback(isRewind) {
        const overlay = this.elements.doubleTapOverlay;
        const backward = document.getElementById('seek-backward');
        const forward = document.getElementById('seek-forward');
        
        if (!overlay || !backward || !forward) return;
        
        // Reset classes
        overlay.classList.remove('active');
        backward.classList.remove('show');
        forward.classList.remove('show');
        
        // Force reflow
        void overlay.offsetWidth;
        
        // Show appropriate feedback
        overlay.classList.add('active');
        if (isRewind) {
            backward.classList.add('show');
        } else {
            forward.classList.add('show');
        }
        
        // Hide after animation completes
        setTimeout(() => {
            overlay.classList.remove('active');
            backward.classList.remove('show');
            forward.classList.remove('show');
        }, 600);
    }
    
    // Controls Management
    showControls() {
        if (this.controlsTimeout) {
            clearTimeout(this.controlsTimeout);
        }
        
        if (this.player && !this.controlsVisible) {
            const controls = document.querySelector('.plyr__controls');
            if (controls) {
                controls.classList.remove('hidden');
                this.controlsVisible = true;
            }
        }
        
        // Set timeout to hide controls
        if (this.player && this.player.playing) {
            this.controlsTimeout = setTimeout(() => {
                this.hideControls();
            }, this.controlsHideDelay);
        }
    }
    
    hideControls() {
        if (this.player && this.controlsVisible && this.player.playing) {
            const controls = document.querySelector('.plyr__controls');
            if (controls) {
                controls.classList.add('hidden');
                this.controlsVisible = false;
            }
        }
    }
    
    // Video Loading and Management
    loadVideo(videoId, lectureTitle) {
        if (this.isLoading) {
            this.pendingVideoRequest = { videoId, lectureTitle };
            return;
        }
        
        console.log('Loading video:', videoId, lectureTitle);
        this.isLoading = true;
        
        this.elements.lectureNameElement.textContent = `Loading: ${lectureTitle}`;
        this.elements.videoPlaceholder.style.display = 'none';
        this.elements.playerContainer.style.display = 'block';
        
        this.showLoading();
        
        if (this.player) {
            this.player.destroy();
            this.player = null;
        }
        
        const newIframe = document.createElement('iframe');
        newIframe.id = 'lecture-video';
        newIframe.className = 'plyr__video-embed';
        newIframe.src = `https://www.youtube.com/embed/${videoId}?origin=https://plyr.io&enablejsapi=1&widgetid=1`;
        newIframe.frameBorder = '0';
        newIframe.allowFullscreen = true;
        newIframe.allow = 'autoplay';
        newIframe.style.pointerEvents = 'none';
        
        const oldIframe = document.getElementById('lecture-video');
        oldIframe.parentNode.replaceChild(newIframe, oldIframe);
        
        const videoInfo = document.querySelector('.video-info');
        videoInfo.style.animation = 'slideIn 0.5s ease';
        setTimeout(() => {
            videoInfo.style.animation = '';
        }, 500);
        
        setTimeout(() => {
            try {
                this.player = new Plyr('#player', {
                    controls: [
                        'play-large',
                        'rewind',
                        'play',
                        'fast-forward',
                        'progress',
                        'current-time',
                        'mute',
                        'volume',
                        'settings',
                        'pip',
                        'fullscreen'
                    ],
                    hideControls: false,
                    clickToPlay: false,
                    touch: true,
                    youtube: {
                        noCookie: true,
                        rel: 0,
                        showinfo: 0,
                        iv_load_policy: 3,
                        modestbranding: 1
                    },
                    i18n: {
                        rewind: 'Rewind {seektime}s',
                        fastForward: 'Forward {seektime}s'
                    },
                    seekTime: 10,
                    fullscreen: {
                        enabled: true,
                        fallback: true,
                        iosNative: false,
                        container: null
                    }
                });
                
                this.setupPlayerEventListeners();
                
            } catch (error) {
                console.error('Player initialization error:', error);
                this.isLoading = false;
                this.hideLoading();
                this.elements.lectureNameElement.textContent = 'Error initializing player';
                this.showError();
            }
        }, 800);
    }
    
    setupPlayerEventListeners() {
        if (!this.player) return;
        
        this.player.on('ready', () => {
            console.log('Player ready');
            this.isLoading = false;
            this.hideLoading();
            this.hideError();
            
            this.preventIframePointerEvents();
            this.updateOverlayPosition();
            this.initializeTouchControls();
            
            // Auto-show controls when video loads
            this.showControls();
            
            if (this.pendingVideoRequest) {
                const nextVideo = this.pendingVideoRequest;
                this.pendingVideoRequest = null;
                setTimeout(() => {
                    this.loadVideo(nextVideo.videoId, nextVideo.lectureTitle);
                }, 500);
            }
        });
        
        this.player.on('error', () => {
            console.error('Player load error');
            this.isLoading = false;
            this.hideLoading();
            this.elements.lectureNameElement.textContent = 'Error loading video';
            this.showError();
        });
        
        this.player.on('play', () => {
            this.preventIframePointerEvents();
            if (this.isTouchDevice) {
                this.setupDoubleTapEventListeners();
            }
            this.hideControls();
        });
        
        this.player.on('pause', () => {
            this.preventIframePointerEvents();
            this.showControls();
        });
        
        this.player.on('enterfullscreen', () => {
            this.updateOverlayPosition();
            if (this.isTouchDevice) {
                setTimeout(() => this.initializeTouchControls(), 100);
                setTimeout(() => this.setupDoubleTapEventListeners(), 200);
            }
            
            if (screen.orientation && screen.orientation.lock) {
                screen.orientation.lock('landscape').catch(() => {});
            }
        });
        
        this.player.on('exitfullscreen', () => {
            this.updateOverlayPosition();
            if (this.isTouchDevice) {
                setTimeout(() => this.initializeTouchControls(), 100);
                setTimeout(() => this.setupDoubleTapEventListeners(), 200);
            }
            
            if (screen.orientation && screen.orientation.unlock) {
                screen.orientation.unlock();
            }
        });
    }
    
    preventIframePointerEvents() {
        const iframe = document.getElementById('lecture-video');
        if (iframe) {
            // Allow pointer events when paused, block when playing
            if (this.player && this.player.playing) {
                iframe.style.pointerEvents = 'none';
            } else {
                iframe.style.pointerEvents = 'auto';
            }
        }
    }
    
    initializeTouchControls() {
        if (!this.isTouchDevice) return;
        
        console.log('Touch device detected - initializing touch controls');
        
        // Add touch class to player
        const playerElement = document.querySelector('.plyr');
        if (playerElement) {
            playerElement.classList.add('plyr--touch');
        }
        
        // Create touch overlay
        let touchOverlay = document.getElementById('touch-overlay');
        if (!touchOverlay) {
            touchOverlay = document.createElement('div');
            touchOverlay.className = 'touch-overlay';
            touchOverlay.id = 'touch-overlay';
            document.querySelector('.video-container').appendChild(touchOverlay);
        }
        
        // Ensure touch overlay is properly configured
        touchOverlay.style.display = 'block';
        touchOverlay.style.pointerEvents = 'auto';
        touchOverlay.style.zIndex = '16';
        
        // Remove existing event listeners
        touchOverlay.removeEventListener('touchstart', this.handleTouchOverlayTap.bind(this));
        touchOverlay.removeEventListener('click', this.handleTouchOverlayTap.bind(this));
        
        // Add new event listeners
        touchOverlay.addEventListener('touchstart', this.handleTouchOverlayTap.bind(this), { passive: true });
        touchOverlay.addEventListener('click', this.handleTouchOverlayTap.bind(this), { passive: true });
        
        console.log('Touch controls initialized');
    }
    
    handleTouchOverlayTap(e) {
        if (!this.isTouchDevice || !this.player) return;
        
        e.preventDefault();
        e.stopPropagation();
        
        if (this.controlsVisible) {
            this.hideControls();
        } else {
            this.showControls();
        }
    }
    
    // Loading and Error States
    showLoading() {
        this.isLoading = true;
        if (this.elements.videoLoading) {
            this.elements.videoLoading.classList.add('active');
        }
    }
    
    hideLoading() {
        this.isLoading = false;
        if (this.elements.videoLoading) {
            this.elements.videoLoading.classList.remove('active');
        }
    }
    
    showError() {
        this.hasError = true;
        if (this.elements.videoError) {
            this.elements.videoError.classList.add('active');
        }
    }
    
    hideError() {
        this.hasError = false;
        if (this.elements.videoError) {
            this.elements.videoError.classList.remove('active');
        }
    }
    
    retryLoad() {
        this.hideError();
        this.showLoading();
        if (this.activeLecture) {
            // Reload current lecture
            const subject = subjectsData.find(s => 
                s.lectures.some(lecture => lecture.videoId === this.activeLecture.videoId)
            );
            if (subject) {
                const lecture = subject.lectures.find(l => l.videoId === this.activeLecture.videoId);
                if (lecture) {
                    this.loadVideo(lecture.videoId, lecture.title);
                }
            }
        }
    }
    
    // Overlay and Fullscreen Management
    setupOverlayProtection() {
        const doubleTapOverlay = this.elements.doubleTapOverlay;
        if (doubleTapOverlay) {
            doubleTapOverlay.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                return false;
            });
        }
        
        document.addEventListener('fullscreenchange', () => this.updateOverlayPosition());
        document.addEventListener('webkitfullscreenchange', () => this.updateOverlayPosition());
        document.addEventListener('mozfullscreenchange', () => this.updateOverlayPosition());
        document.addEventListener('MSFullscreenChange', () => this.updateOverlayPosition());
    }
    
    updateOverlayPosition() {
        const overlay = document.getElementById('iframe-overlay');
        if (!overlay) return;
        
        const playerElement = document.querySelector('.plyr');
        
        if (playerElement && playerElement.classList.contains('plyr--fullscreen-active')) {
            overlay.style.position = 'fixed';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.width = '100vw';
            overlay.style.height = '100vh';
            overlay.style.zIndex = '10';
        } else {
            overlay.style.position = 'absolute';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.width = '100%';
            overlay.style.height = '100%';
            overlay.style.zIndex = '10';
        }
        
        this.updateDoubleTapOverlay();
    }
    
    updateDoubleTapOverlay() {
        const doubleTapOverlay = this.elements.doubleTapOverlay;
        if (!doubleTapOverlay) return;
        
        const playerElement = document.querySelector('.plyr');
        
        if (playerElement && playerElement.classList.contains('plyr--fullscreen-active')) {
            doubleTapOverlay.style.position = 'fixed';
            doubleTapOverlay.style.top = '0';
            doubleTapOverlay.style.left = '0';
            doubleTapOverlay.style.width = '100vw';
            doubleTapOverlay.style.height = '100vh';
            doubleTapOverlay.style.zIndex = '15';
        } else {
            doubleTapOverlay.style.position = 'absolute';
            doubleTapOverlay.style.top = '0';
            doubleTapOverlay.style.left = '0';
            doubleTapOverlay.style.width = '100%';
            doubleTapOverlay.style.height = '100%';
            doubleTapOverlay.style.zIndex = '15';
        }
    }
    
    // Subjects and Lectures Management
    populateSubjects() {
        if (!this.elements.subjectsList) return;
        
        this.elements.subjectsList.innerHTML = '';
        
        subjectsData.filter(subject => subject.lectures && subject.lectures.length > 0).forEach(subject => {
            const subjectItem = document.createElement('div');
            subjectItem.className = 'subject-item';
            
            const hasNewLectures = this.checkSubjectHasNewLectures(subject);
            
            const subjectHeader = document.createElement('div');
            subjectHeader.className = 'subject-header';
            subjectHeader.setAttribute('data-subject-name', subject.name);
            subjectHeader.innerHTML = `
                <i class="subject-icon ${subject.icon}" style="color: ${subject.color};"></i>
                <span class="subject-title">${subject.name}</span>
                <div class="badge-container">
                    ${hasNewLectures ? '<span class="badge badge-new">New</span>' : ''}
                </div>
                <i class="dropdown-icon fas fa-chevron-down"></i>
            `;
            
            const lecturesList = document.createElement('div');
            lecturesList.className = 'lectures-list';
            
            subject.lectures.forEach((lecture, index) => {
                const lectureItem = document.createElement('div');
                lectureItem.className = 'lecture-item';
                lectureItem.dataset.subject = subject.name;
                lectureItem.dataset.lectureIndex = index;
                
                const isNewLecture = this.isLectureNew(lecture.videoId);
                const showLimitedTimeIcon = subject.isPCMB && this.isWithin24hWindow();
                
                lectureItem.innerHTML = `
                    <i class="lecture-icon fas fa-play-circle" style="color: ${subject.color};"></i>
                    <span class="lecture-title">${lecture.title}</span>
                    <div class="lecture-badges">
                        ${isNewLecture ? '<span class="badge badge-new">New</span>' : ''}
                        ${showLimitedTimeIcon ? '<i class="limited-time-icon fas fa-clock"></i>' : ''}
                    </div>
                `;
                
                lectureItem.addEventListener('click', () => {
                    this.loadVideo(lecture.videoId, lecture.title);
                    this.setActiveLecture(lectureItem, subject.name, index, lecture);
                    this.markLectureAsWatched(lecture.videoId, subject.name, index);
                    
                    lectureItem.style.animation = 'scaleIn 0.3s ease';
                    setTimeout(() => {
                        lectureItem.style.animation = '';
                    }, 300);
                });
                
                lecturesList.appendChild(lectureItem);
            });
            
            subjectHeader.addEventListener('click', () => {
                const isOpen = lecturesList.classList.contains('open');
                
                document.querySelectorAll('.lectures-list.open').forEach(list => {
                    if (list !== lecturesList) {
                        list.classList.remove('open');
                        const header = list.previousElementSibling;
                        header.querySelector('.dropdown-icon').className = 'dropdown-icon fas fa-chevron-down';
                    }
                });
                
                if (isOpen) {
                    lecturesList.classList.remove('open');
                    subjectHeader.querySelector('.dropdown-icon').className = 'dropdown-icon fas fa-chevron-down';
                } else {
                    lecturesList.classList.add('open');
                    subjectHeader.querySelector('.dropdown-icon').className = 'dropdown-icon fas fa-chevron-up';
                }
            });
            
            subjectItem.appendChild(subjectHeader);
            subjectItem.appendChild(lecturesList);
            this.elements.subjectsList.appendChild(subjectItem);
        });
    }
    
    setActiveLecture(lectureElement, subjectName, lectureIndex, lecture) {
        document.querySelectorAll('.lecture-item').forEach(item => {
            item.classList.remove('active');
        });
        
        lectureElement.classList.add('active');
        
        this.activeLecture = {
            element: lectureElement,
            subject: subjectName,
            index: lectureIndex,
            videoId: lecture.videoId,
            title: lecture.title
        };
    }
    
    // Lecture Tracking
    initializeNewLectureTracking() {
        let watchedLectures = JSON.parse(localStorage.getItem('watchedLectures')) || [];
        
        const allVideoIds = [];
        subjectsData.forEach(subject => {
            subject.lectures.forEach(lecture => {
                allVideoIds.push(lecture.videoId);
            });
        });
        
        watchedLectures = watchedLectures.filter(id => allVideoIds.includes(id));
        localStorage.setItem('watchedLectures', JSON.stringify(watchedLectures));
    }
    
    isLectureNew(videoId) {
        const watchedLectures = JSON.parse(localStorage.getItem('watchedLectures')) || [];
        return !watchedLectures.includes(videoId);
    }
    
    checkSubjectHasNewLectures(subject) {
        const watchedLectures = JSON.parse(localStorage.getItem('watchedLectures')) || [];
        return subject.lectures.some(lecture => !watchedLectures.includes(lecture.videoId));
    }
    
    markLectureAsWatched(videoId, subjectName, lectureIndex) {
        let watchedLectures = JSON.parse(localStorage.getItem('watchedLectures')) || [];
        
        if (!watchedLectures.includes(videoId)) {
            watchedLectures.push(videoId);
            localStorage.setItem('watchedLectures', JSON.stringify(watchedLectures));
            this.updateLectureBadge(subjectName, lectureIndex);
            this.updateSubjectBadge(subjectName);
        }
    }
    
    updateLectureBadge(subjectName, lectureIndex) {
        const lectureItem = document.querySelector(`.lecture-item[data-subject="${subjectName}"][data-lecture-index="${lectureIndex}"]`);
        if (lectureItem) {
            const newBadge = lectureItem.querySelector('.badge-new');
            if (newBadge) {
                newBadge.remove();
            }
        }
    }
    
    updateSubjectBadge(subjectName) {
        const subject = subjectsData.find(s => s.name === subjectName);
        if (subject) {
            const hasNewLectures = this.checkSubjectHasNewLectures(subject);
            const subjectHeader = document.querySelector(`.subject-header[data-subject-name="${subjectName}"]`);
            
            if (subjectHeader) {
                const badgeContainer = subjectHeader.querySelector('.badge-container');
                const existingBadge = subjectHeader.querySelector('.badge-new');
                
                if (hasNewLectures && !existingBadge) {
                    const newBadge = document.createElement('span');
                    newBadge.className = 'badge badge-new';
                    newBadge.textContent = 'New';
                    badgeContainer.appendChild(newBadge);
                } else if (!hasNewLectures && existingBadge) {
                    existingBadge.remove();
                }
            }
        }
    }
    
    isWithin24hWindow() {
        const now = new Date();
        const today4_00 = new Date();
        today4_00.setHours(16, 0, 0, 0);
        
        const startTime = now < today4_00 ? 
            new Date(today4_00.getTime() - 24 * 60 * 60 * 1000) : 
            today4_00;
            
        const endTime = new Date(startTime.getTime() + 24 * 60 * 60 * 1000);
        
        return now >= startTime && now < endTime;
    }
    
    updatePCMBTimer() {
        const now = new Date();
        const today4_00 = new Date();
        today4_00.setHours(16, 0, 0, 0);
        
        let nextReset;
        
        if (now < today4_00) {
            nextReset = today4_00;
        } else {
            nextReset = new Date(today4_00.getTime() + 24 * 60 * 60 * 1000);
        }
        
        const timeLeft = nextReset - now;
        
        if (timeLeft <= 0) {
            this.elements.pcmbTimerElement.textContent = "PCMB Time Left: Reset!";
            return;
        }
        
        const hours = Math.floor(timeLeft / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        
        this.elements.pcmbTimerElement.textContent = `PCMB Time Left: ${hours} Hours ${minutes} Minutes`;
    }
    
    // Event Listeners
    setupEventListeners() {
        // Retry button
        if (this.elements.retryButton) {
            this.elements.retryButton.addEventListener('click', () => this.retryLoad());
        }
        
        // Orientation changes
        window.addEventListener('orientationchange', () => {
            if (this.isTouchDevice && this.player) {
                setTimeout(() => this.initializeTouchControls(), 300);
                setTimeout(() => this.updateDoubleTapOverlay(), 300);
            }
        });
    }
    
    // Cleanup
    destroy() {
        // Clear timeouts
        if (this.tapTimeout) {
            clearTimeout(this.tapTimeout);
        }
        if (this.controlsTimeout) {
            clearTimeout(this.controlsTimeout);
        }
        
        // Destroy Plyr instance
        if (this.player) {
            this.player.destroy();
            this.player = null;
        }
        
        this.isInitialized = false;
    }
}

// Access verification script
(function() {
    const requiredFields = [
        'accessGranted',
        'accessKey', 
        'accessTime',
        'userGmail',
        'userName',
        'verificationCode'
    ];
    
    let hasValidAccess = true;
    
    for (const field of requiredFields) {
        const value = localStorage.getItem(field);
        
        if (!value || value.trim() === '' || value === 'null' || value === 'undefined') {
            hasValidAccess = false;
            break;
        }
    }
    
    if (localStorage.getItem('accessGranted') !== 'true') {
        hasValidAccess = false;
    }
    
    if (!hasValidAccess) {
        window.location.href = 'log.html';
    }
})();

// Global variables
let videoPlayer;

// Initialize the page when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    videoPlayer = new CustomVideoPlayer();
});

// Handle page visibility changes to prevent memory leaks
document.addEventListener('visibilitychange', function() {
    if (document.hidden && videoPlayer && videoPlayer.player) {
        // Page is hidden, pause video
        if (videoPlayer.player.playing) {
            videoPlayer.player.pause();
        }
    }
});

// Handle page unload to clean up
window.addEventListener('beforeunload', function() {
    if (videoPlayer) {
        videoPlayer.destroy();
    }
});

// Navigate to home page
function goToHome() {
    window.location.href = 'index.html';
}
</script>
</body>
</html>
