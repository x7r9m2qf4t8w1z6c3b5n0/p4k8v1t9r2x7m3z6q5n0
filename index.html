<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
<link rel="preload" href="https://img.icons8.com/fluency/48/instagram-verification-badge.png" as="image" crossorigin="anonymous">
<link rel="dns-prefetch" href="https://img.icons8.com">
<link rel="preconnect" href="https://img.icons8.com">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìö</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Hind Siliguri', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #0a0a0a;
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 20px;
            position: relative;
            padding-top: 120px; /* Account for fixed header */
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(26, 26, 46, 0.5) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(15, 52, 96, 0.4) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(22, 33, 62, 0.3) 0%, transparent 30%);
            z-index: -1;
        }

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 12px;
    width: 100%;
    box-sizing: border-box;
    overflow-x: hidden; /* Prevent horizontal scroll */
}
body {
    background: #0a0a0a;
    color: #ffffff;
    line-height: 1.6;
    min-height: 100vh;
    padding-bottom: 20px;
    position: relative;
    padding-top: 120px;
    overflow-x: hidden; /* Prevent horizontal scroll */
    width: 100%;
}

        /* Header Styles */
        .header {
            background: rgba(15, 15, 20, 0.9);
            color: #ffffff;
            padding: 15px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .header::before {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 5%;
            width: 90%;
            height: 10px;
            background: rgba(255, 255, 255, 0.05);
            filter: blur(10px);
            border-radius: 50%;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }

        .logo-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo {
            height: 70px;
            width: 70px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid transparent;
            background: linear-gradient(135deg, #ffffff, #a0aec0);
            background-clip: padding-box;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            animation: logo-glow 3s infinite alternate;
        }

        @keyframes logo-glow {
            0% {
                box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
            }
            100% {
                box-shadow: 0 0 25px rgba(255, 255, 255, 0.7);
            }
        }

        .logo-text {
            font-size: 42px;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
            margin-left: 15px;
        }

        .divider {
            height: 2px;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.5), transparent);
            margin: 10px 0;
        }

        /* User Info Section */
        .user-info-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(20, 20, 30, 0.6);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-info-section::before {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 5%;
            width: 90%;
            height: 10px;
            background: rgba(255, 255, 255, 0.05);
            filter: blur(10px);
            border-radius: 50%;
        }

.time-date {
    text-align: center;
    position: relative;
}

.big-time {
    font-size: 48px;
    font-weight: 700;
    color: #ffffff;
    margin-bottom: 5px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center; 
    gap: 10px;
}

.big-time i {
    font-size: 40px;
    color: #feca57; /* Golden color for clock icon */
}

.date {
    font-size: 15px;
    color: #e2e8f0;
    font-weight: 600;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: center; 
    gap: 10px;
}

.date i {
    font-size: 15px;
    color: #4ecdc4; /* Teal color for calendar icon */
}

        .short-text {
            font-size: 16px;
            color: #a0aec0;
            font-weight: 500;
        }

        .user-profile {
            display: flex;
            align-items: center;
            text-align: right;
        }

        .user-details {
            margin-right: 15px;
        }

.user-name {
    font-size: 30px;
    font-weight: 700;
    color: #ffffff;
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    justify-content: flex-start; /* Changed from center to flex-start */
    gap: 6px !important; /* Reduced gap from 8px to 6px */
}

/* Updated Profile Icon Styles */
.profile-icon {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(160, 174, 192, 0.8));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #1a202c;
    font-size: 30px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    position: relative;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s ease;
}

.profile-icon:hover {
    transform: scale(1.05);
}

.profile-picture {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
}

.profile-icon-placeholder {
    width: 500px;
    height: 500px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(160, 174, 192, 0.8));
    color: #1a202c;
}

/* Hidden file input */
.profile-picture-input {
    display: none;
}

/* Profile picture upload modal */
.profile-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 2000;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
}

.profile-modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 20, 30, 0.95);
    padding: 30px;
    border-radius: 20px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    text-align: center;
}

.profile-modal-title {
    font-size: 24px;
    font-weight: 700;
    color: white;
    margin-bottom: 20px;
}

.profile-modal.fade-in {
    animation: fadeIn 0.3s ease;
}

.profile-modal.fade-out {
    animation: fadeOut 0.3s ease;
}

.profile-modal-content.scale-in {
    animation: scaleIn 0.3s ease;
}

.profile-modal-content.scale-out {
    animation: scaleOut 0.3s ease;
}

.profile-preview {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    margin: 0 auto 20px;
    overflow: hidden;
    border: 3px solid rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.1);
}

.profile-preview-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.profile-preview-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 0.5);
    font-size: 40px;
}

/* Updated Profile Modal Buttons - Mobile Optimized */
.profile-modal-buttons {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 20px;
    width: 100%;
}

.profile-modal-btn {
    padding: 16px 20px;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 16px;
    width: 100%;
    min-height: 54px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.profile-modal-btn.primary {
    background: rgba(255, 255, 255, 0.9);
    color: #1a202c;
    order: 1; /* Choose Photo first */
}

.profile-modal-btn.primary:hover {
    background: white;
    transform: translateY(-2px);
}

.profile-modal-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    order: 3; /* Remove Photo last */
}

.profile-modal-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

/* Cancel button styling */
#cancelProfileBtn {
    order: 2; /* Cancel in the middle */
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

/* Mobile-specific adjustments */
@media (max-width: 480px) {
    .profile-modal-content {
        padding: 25px 20px;
        margin: 20px;
        width: calc(100% - 40px);
    }
    
    .profile-modal-buttons {
        gap: 10px;
    }
    
    .profile-modal-btn {
        padding: 14px 16px;
        font-size: 15px;
        min-height: 50px;
    }
    
    .profile-preview {
        width: 120px;
        height: 120px;
        margin: 0 auto 15px;
    }
}

@media (max-width: 360px) {
    .profile-modal-content {
        padding: 20px 15px;
    }
    
    .profile-modal-btn {
        padding: 12px 14px;
        font-size: 14px;
        min-height: 46px;
    }
    
    .profile-modal-title {
        font-size: 20px;
    }
}

/* Active state for better touch feedback */
.profile-modal-btn:active {
    transform: scale(0.98);
    transition: transform 0.1s ease;
}

.profile-modal-btn.primary {
    background: rgba(255, 255, 255, 0.9);
    color: #1a202c;
}

.profile-modal-btn.primary:hover {
    background: white;
    transform: translateY(-2px);
}

.profile-modal-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    color: white;
}

.profile-modal-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

        /* Buttons Section */
        .buttons-section {
            margin: 30px 0;
        }

        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 15px;
        }

        .cube-button {
            background: rgba(20, 20, 30, 0.6);
            border-radius: 20px;
            padding: 30px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: #ffffff;
            min-height: 180px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
        }

        .cube-button::before {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 10%;
            width: 80%;
            height: 10px;
            background: rgba(255, 255, 255, 0.05);
            filter: blur(10px);
            border-radius: 50%;
        }

        .cube-button:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.5);
            background: rgba(30, 30, 45, 0.7);
        }

        .cube-button:active {
            transform: translateY(-4px);
        }

.button-icon {
    font-size: 50px;
    margin-bottom: 15px;
    /* Remove the color: #ffffff; line */
}

/* Add individual colors for each button icon */
#classroomBtn .button-icon {
    color: #4CAF50; /* Green for Classroom */
}

#materialsBtn .button-icon {
    color: #2196F3; /* Blue for Materials */
}

#archivesBtn .button-icon {
    color: #FF9800; /* Orange for Archives */
}

        .button-name {
            font-size: 20px;
            font-weight: 700;
            color: #ffffff;
        }

        /* Progress Bar Section */
        .progress-section {
            margin: 30px 0;
            background: rgba(20, 20, 30, 0.6);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .progress-section::before {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 5%;
            width: 90%;
            height: 10px;
            background: rgba(255, 255, 255, 0.05);
            filter: blur(10px);
            border-radius: 50%;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-title {
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
        }

        .progress-time {
            font-size: 16px;
            color: #cbd5e0;
            font-weight: 500;
        }

        .progress-bar-container {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

.progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #ff4444, #ff0000, #cc0000);
    border-radius: 10px;
    transition: width 0.5s ease;
    position: relative;
    overflow: hidden;
}

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

/* Routine Section - Mobile Optimized */
.routine-section {
    background: rgba(20, 20, 30, 0.6);
    border-radius: 20px;
    padding: 20px;
    margin: 25px 0;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
    /* Remove fixed height and add auto-sizing */
    min-height: 200px; /* Minimum height */
    height: auto; /* Auto adjust based on content */
}

/* Routine Cards Container - Remove horizontal scroll */
.routine-cards-container {
    flex: 1;
    overflow-y: auto;
    padding-right: 0; /* Remove right padding */
    width: 100%;
}

/* Routine Table - Make it fit mobile screen */
.routine-table {
    width: 100%;
    border-collapse: collapse;
    min-width: unset; /* Remove minimum width */
    table-layout: fixed; /* Use fixed layout for better control */
}

.routine-table th,
.routine-table td {
    padding: 10px 6px;
    word-wrap: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.3;
}

/* Set specific column widths for mobile */
.routine-table th:nth-child(1),
.routine-table td:nth-child(1) {
    width: 25%; /* Subject column */
}

.routine-table th:nth-child(2),
.routine-table td:nth-child(2) {
    width: 42%; /* Topic column */
    white-space: normal;
    line-height: 1.3;
    min-width: 0; /* Allow flexbox shrinking */
}
.routine-table th:nth-child(3),
.routine-table td:nth-child(3) {
    width: 30%; /* Instructor column */
}

/* Routine Navigation - Ensure it fits */
.routine-navigation {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    width: 100%;
}

.routine-date-display {
    text-align: center;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 0; /* Allow text truncation */
}

.routine-date-title {
    font-size: 16px;
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    gap: 6px;
    width: 100%;
    justify-content: center;
}

.routine-date-title span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 200px;
}

/* Mobile-specific optimizations */
@media (max-width: 768px) {
    .routine-section {
        padding: 15px;
        margin: 20px 0;
    }
    
.routine-table th,
.routine-table td {
    font-size: 10px;
    padding: 6px 3px;
    white-space: normal;
    line-height: 1.2;
}
    
    .routine-table th:nth-child(1),
    .routine-table td:nth-child(1) {
        width: 28%; /* Slightly more for subject */
    }
    
    .routine-table th:nth-child(2),
    .routine-table td:nth-child(2) {
        width: 42%; /* Topic column */
        white-space: normal; /* Allow topic to wrap */
        line-height: 1.3;
    }
    
    .routine-table th:nth-child(3),
    .routine-table td:nth-child(3) {
        width: 30%; /* Instructor column */
    }
    
    .routine-date-title {
        font-size: 14px;
    }
    
    .routine-date-title span {
        max-width: 150px;
    }
    
    .routine-nav-btn {
        width: 35px;
        height: 35px;
        font-size: 14px;
        flex-shrink: 0; /* Prevent button shrinking */
    }
}

@media (max-width: 480px) {
    .routine-section {
        padding: 12px;
    }
    
    .section-title {
        font-size: 20px;
        margin-bottom: 15px;
    }
    
    .routine-table th,
    .routine-table td {
        padding: 6px 3px;
        font-size: 11px;
    }
    
    .routine-table th:nth-child(1),
    .routine-table td:nth-child(1) {
        width: 30%;
    }
    
    .routine-table th:nth-child(2),
    .routine-table td:nth-child(2) {
        width: 40%;
    }
    
    .routine-table th:nth-child(3),
    .routine-table td:nth-child(3) {
        width: 30%;
    }
    
    .routine-date-title {
        font-size: 13px;
    }
    
    .routine-date-title span {
        max-width: 120px;
    }
    
    .routine-nav-btn {
        width: 32px;
        height: 32px;
        font-size: 12px;
    }
    
    .routine-nav-dot {
        width: 6px;
        height: 6px;
    }
}

/* For very small screens */
@media (max-width: 360px) {
    .routine-table th,
    .routine-table td {
        font-size: 10px;
        padding: 5px 2px;
    }
    
    .routine-date-title {
        font-size: 12px;
    }
    
    .routine-date-title span {
        max-width: 100px;
    }
}

        .section-title {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            padding-bottom: 10px;
            flex-shrink: 0; /* Prevent title from shrinking */
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(to right, rgba(255, 255, 255, 0.7), rgba(160, 174, 192, 0.7));
            border-radius: 3px;
        }

        /* Table container with fixed height and improved header blur */
        .table-container {
            max-height: 400px; /* Reduced to fit within section */
            overflow-y: auto;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            flex: 1; /* Take remaining space */
            position: relative;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        /* Improved table header with better blur effect */
th {
    background: linear-gradient(135deg, #2a2a3a, #3a3a4a);
    color: white;
    font-weight: 700;
    padding: 15px 10px;
    text-align: left;
    position: sticky;  /* ‚Üê CHANGE THIS FROM 'static' TO 'sticky' */
    top: 0;
    z-index: 10;
    background-color: #2d2d3d;
    border-bottom: 2px solid rgba(255, 255, 255, 0.3);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
}

        td {
            padding: 12px 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-weight: 500;
            background: rgba(20, 20, 30, 0.3);
        }

        tr:nth-child(even) td {
            background-color: rgba(255, 255, 255, 0.03);
        }

        tr:hover td {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .completed {
            color: #48bb78;
        }

        .completed-icon {
            color: #48bb78;
            margin-right: 5px;
        }

        /* Mobile routine container with fixed height */
        .mobile-routine {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
            flex: 1; /* Take remaining space */
        }

        .routine-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
            margin-bottom: 0;
        }

        .routine-card:hover {
            transform: translateY(-5px);
            margin-bottom: 5px;
        }

.routine-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: relative; /* Add this */
    z-index: 1; /* Add this */
}

        .routine-date {
            font-weight: 700;
            color: white;
        }

        .routine-subject {
            color: #cbd5e0;
            font-weight: 600;
        }

        .routine-details {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }

        .routine-detail {
            display: flex;
            justify-content: space-between;
        }

        .routine-label {
            color: #a0aec0;
            font-weight: 500;
        }

        .routine-value {
            color: white;
            font-weight: 500;
            text-align: right;
        }

        .completed-card {
            border-left: 4px solid #48bb78;
        }

        .expand-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 15px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            flex-shrink: 0; /* Prevent button from shrinking */
        }

        .expand-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

/* Instructions Section - Fixed Scroller */
.instructions-section {
    background: rgba(20, 20, 30, 0.6);
    border-radius: 20px;
    padding: 25px;
    margin: 30px 0;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
    min-height: 200px;
    height: auto;
}

.instructions-container {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    margin: 20px 0;
    min-height: 150px;
    height: auto;
    width: 100%;
    gap: 20px; /* Use gap instead of individual margins */
}

.instructions-scroller {
    flex: 0 0 calc(100% - 140px); /* Fixed width accounting for buttons */
    position: relative;
    overflow: hidden;
    min-height: 120px;
    height: auto;
    max-width: 800px;
    margin: 0 auto; /* Center it */
}

.scroll-btn {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    width: 50px; /* Fixed width */
    height: 50px; /* Fixed height */
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    flex-shrink: 0; /* Prevent shrinking */
    font-size: 18px;
    /* Always maintain layout space */
    visibility: visible;
    opacity: 1;
}

/* Hidden state - keep in layout but make invisible */
.scroll-btn.hidden {
    opacity: 0;
    pointer-events: none;
    cursor: default;
}

.scroll-btn:not(.hidden):hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
}

.scroll-btn:not(.hidden):active {
    transform: scale(0.95);
}

/* Remove individual margin classes since we're using gap */
.scroll-left,
.scroll-right {
    margin: 0;
}

.instruction-items-wrapper {
    display: flex;
    transition: transform 0.5s ease;
    width: 100%;
    height: 100%;
}

.instruction-item {
    flex: 0 0 100%;
    min-width: 100%;
    padding: 25px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    border-left: 4px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    display: flex;
    align-items: flex-start; /* Align content to top */
}

.instruction-item:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

.instruction-text {
    font-size: 16px;
    font-weight: 500;
    line-height: 1.7;
    margin: 0;
    text-align: justify;
}

.scroll-btn {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    flex-shrink: 0;
    font-size: 18px;
    opacity: 1;
    visibility: visible;
    transition: all 0.3s ease;
}

.scroll-btn.hidden {
    opacity: 0;
    pointer-events: none;
    cursor: default;
    /* REMOVE display: none and width changes */
}

.scroll-btn:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
}

.scroll-btn:active:not(:disabled) {
    transform: scale(0.95);
}

.scroll-btn:disabled {
    opacity: 0;
    pointer-events: none;
    cursor: default;
}

.scroll-btn:disabled:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: none;
}

.scroll-left {
    margin-right: 20px;
}

.scroll-right {
    margin-left: 20px;
}

.instructions-indicator {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-top: 25px;
}

.indicator-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
}

.indicator-dot.active {
    background: rgba(255, 255, 255, 0.9);
    transform: scale(1.3);
}

.indicator-dot:hover {
    background: rgba(255, 255, 255, 0.6);
}

/* Responsive Design for Instructions */
@media (max-width: 768px) {
    .instruction-item {
        padding: 20px;
    }
    
    .instruction-text {
        font-size: 15px;
        line-height: 1.6;
    }
    
    .scroll-btn {
        width: 45px;
        height: 45px;
        font-size: 16px;
    }
    
    .instructions-scroller {
        margin: 0 15px; /* Adjusted for mobile */
    }
    
    .instructions-container {
        min-height: 180px;
    }
}

@media (max-width: 480px) {
    .instructions-section {
        padding: 15px;
    }
    
    .instruction-item {
        padding: 15px;
    }
    
    .instruction-text {
        font-size: 14px;
        line-height: 1.5;
    }
    
    .scroll-btn {
        width: 40px;
        height: 40px;
        font-size: 14px;
    }
    
    .scroll-left {
        margin-right: 10px;
    }
    
    .scroll-right {
        margin-left: 10px;
    }
    
    .instructions-indicator {
        gap: 8px;
        margin-top: 20px;
    }
    
    .indicator-dot {
        width: 10px;
        height: 10px;
    }
    
    .instructions-container {
        min-height: 160px;
    }
}        
@media (max-width: 768px) {
    .scroll-btn {
        width: 45px;
        height: 45px;
        font-size: 16px;
        transition: all 0.3s ease;
    }
}

@media (max-width: 480px) {
    .scroll-btn {
        width: 40px;
        height: 40px;
        font-size: 14px;
        transition: all 0.3s ease;
    }
}
/* Modal for expanded routine view */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .modal.fade-in {
            animation: fadeIn 0.3s ease;
        }

        .modal.fade-out {
            animation: fadeOut 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

.modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 20, 30, 0.9);
    padding: 0;
    border-radius: 20px;
    width: 90%;
    max-width: 800px;
    max-height: 85vh; /* Increased from 80vh to 85vh */
    overflow: hidden;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    flex-direction: column;
}
        .modal-content.scale-in {
            animation: scaleIn 0.3s ease;
        }

        .modal-content.scale-out {
            animation: scaleOut 0.3s ease;
        }

        @keyframes scaleIn {
            from { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        @keyframes scaleOut {
            from { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            to { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
        }

.modal-header {
    display: flex;
    flex-direction: column;
    padding: 20px 30px 15px 30px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: sticky;
    top: 0;
    background: rgba(20, 20, 30, 0.98);
    z-index: 100;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    margin-bottom: 0;
    gap: 15px;
}

.modal-title-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
}

.modal-title {
    font-size: 24px;
    font-weight: 700;
    color: white;
    margin: 0;
}

.close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    transition: transform 0.3s ease;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    flex-shrink: 0;
}

.close-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.1);
}

/* Update modal-routine-container height calculation */
.modal-routine-container {
    padding: 0 30px 30px 30px;
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
    overflow-y: auto;
    flex-grow: 1;
    /* Increased height to account for search bar */
    max-height: calc(80vh - 140px);
}

        /* Custom scrollbar for mobile routine */
        .mobile-routine::-webkit-scrollbar {
            width: 6px;
        }

        .mobile-routine::-webkit-scrollbar-track {
            background: rgba(20, 20, 30, 0.5);
            border-radius: 10px;
        }

        .mobile-routine::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.5), rgba(160, 174, 192, 0.5));
            border-radius: 10px;
        }

        .mobile-routine::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, rgba(160, 174, 192, 0.5), rgba(255, 255, 255, 0.5));
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding-top: 110px;
            }
            
            .logo-text {
                font-size: 36px;
            }
            
            .logo {
                height: 60px;
                width: 60px;
            }
            
            .user-info-section {
                flex-direction: column;
                text-align: center;
            }
            
            .time-date {
                text-align: center;
                margin-bottom: 15px;
            }
            
            .user-profile {
                text-align: center;
                flex-direction: column-reverse;
            }
            
            .user-details {
                margin-right: 0;
                margin-top: 15px;
            }
            
            .big-time {
                font-size: 36px;
            }
            
            .date {
                font-size: 15px;
            }
            
            .buttons-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
            
            .cube-button {
                min-height: 150px;
                padding: 25px 10px;
            }
            
            .button-icon {
                font-size: 40px;
            }
            
            .button-name {
                font-size: 18px;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .table-container {
                overflow-x: auto;
            }

            /* Mobile routine table */
            .mobile-routine {
                display: flex;
                flex-direction: column;
                gap: 15px;
                max-height: 350px; /* Adjusted for mobile */
            }

            .desktop-table {
                display: none;
            }

            .routine-section {
                max-height: 550px; /* Slightly smaller on mobile */
            }

            /* Instructions responsive */
            .instruction-item {
                padding: 20px;
            }
            
            .instruction-text {
                font-size: 15px;
                line-height: 1.6;
            }
            
            .scroll-btn {
                width: 45px;
                height: 45px;
                font-size: 16px;
            }
            
            .scroll-left {
                margin-right: 15px;
            }
            
            .scroll-right {
                margin-left: 15px;
            }
        }

        @media (min-width: 769px) {
            .mobile-routine {
                display: none;
            }

            .desktop-table {
                display: block;
            }
        }

        @media (max-width: 600px) {
            .buttons-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .cube-button {
                min-height: 130px;
                padding: 20px 5px;
            }
            
            .button-icon {
                font-size: 30px;
            }
            
            .button-name {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding-top: 100px;
            }
            
            .logo-text {
                font-size: 30px;
            }
            
            .logo {
                height: 50px;
                width: 50px;
            }
            
            .big-time {
                font-size: 40px;
            }
            
            .date {
                font-size: 12px;
            }
            
            .user-name {
                font-size: 26px;
            }
            
            .button-icon {
                font-size: 40px;
            }
            
            .button-name {
                font-size: 14px;
            }
            
            .section-title {
                font-size: 30px;
            }
            
            th, td {
                padding: 10px 8px;
                font-size: 14px;
            }

            .routine-section {
                max-height: 10000px; /* Even smaller on very small screens */
            }

            .mobile-routine {
                max-height: 300px;
            }

            /* Instructions responsive */
            .instructions-section {
                padding: 15px;
            }
            
            .instruction-item {
                padding: 15px;
            }
            
            .instruction-text {
                font-size: 14px;
                line-height: 1.5;
            }
            
            .scroll-btn {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }
            
            .scroll-left {
                margin-right: 10px;
            }
            
            .scroll-right {
                margin-left: 10px;
            }
            
            .instructions-indicator {
                gap: 8px;
                margin-top: 20px;
            }
            
            .indicator-dot {
                width: 10px;
                height: 10px;
            }
        }

        /* For very small screens */
        @media (max-width: 360px) {
            .instruction-text {
                font-size: 13px;
            }
            
            .scroll-btn {
                width: 35px;
                height: 35px;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(20, 20, 30, 0.5);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.5), rgba(160, 174, 192, 0.5));
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, rgba(160, 174, 192, 0.5), rgba(255, 255, 255, 0.5));
        }

        /* Ripple Effect */
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
/* Updated Progress Bar Styles */
.progress-header {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 15px;
    text-align: center;
}

.progress-title {
    display: none; /* Hide the title */
}
/* Confirmation Modal Styles */
.confirmation-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 4000;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
}

.confirmation-modal.fade-in {
    animation: fadeIn 0.3s ease;
}

.confirmation-modal.fade-out {
    animation: fadeOut 0.3s ease;
}

.confirmation-modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 20, 30, 0.95);
    padding: 30px;
    border-radius: 20px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    text-align: center;
}

.confirmation-modal-title {
    font-size: 24px;
    font-weight: 700;
    color: white;
    margin-bottom: 20px;
}

.confirmation-modal-message {
    font-size: 16px;
    color: #cbd5e0;
    margin-bottom: 25px;
    line-height: 1.6;
}

/* Updated Confirmation Modal Buttons - Mobile Optimized */
.confirmation-modal-buttons {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
}

.confirmation-modal-btn {
    padding: 16px 20px;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 16px;
    width: 100%;
    min-height: 54px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.confirmation-modal-btn.proceed {
    background: rgba(239, 68, 68, 0.9);
    color: white;
    order: 2; /* Proceed second */
}

.confirmation-modal-btn.proceed:hover {
    background: rgba(239, 68, 68, 1);
    transform: translateY(-2px);
}

.confirmation-modal-btn.cancel {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    order: 1; /* Cancel first */
}

.confirmation-modal-btn.cancel:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

/* Mobile-specific adjustments for confirmation modal */
@media (max-width: 480px) {
    .confirmation-modal-content {
        padding: 25px 20px;
        margin: 20px;
        width: calc(100% - 40px);
    }
    
    .confirmation-modal-buttons {
        gap: 10px;
    }
    
    .confirmation-modal-btn {
        padding: 14px 16px;
        font-size: 15px;
        min-height: 50px;
    }
}

@media (max-width: 360px) {
    .confirmation-modal-content {
        padding: 20px 15px;
    }
    
    .confirmation-modal-btn {
        padding: 12px 14px;
        font-size: 14px;
        min-height: 46px;
    }
    
    .confirmation-modal-title {
        font-size: 20px;
    }
    
    .confirmation-modal-message {
        font-size: 14px;
    }
}

/* Active state for better touch feedback */
.confirmation-modal-btn:active {
    transform: scale(0.98);
    transition: transform 0.1s ease;
}

.confirmation-modal-btn.proceed {
    background: rgba(239, 68, 68, 0.9);
    color: white;
}

.confirmation-modal-btn.proceed:hover {
    background: rgba(239, 68, 68, 1);
    transform: translateY(-2px);
}

.confirmation-modal-btn.cancel {
    background: rgba(255, 255, 255, 0.1);
    color: white;
}

.confirmation-modal-btn.cancel:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}
/* PCMB Timer Styles */
.pcmb-timer {
    text-align: center;
    color: #ff4d4d;
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 15px;
    background: rgba(255, 77, 77, 0.1);
    padding: 5px 10px;
    border-radius: 5px;
    border: 1px solid rgba(255, 77, 77, 0.3);
    flex-shrink: 0;
}

.limited-time-icon {
    color: #ff4d4d;
    font-size: 16px;
    margin-left: 5px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}
/* Routine Navigation */
.routine-navigation {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    position: relative;
}

.routine-nav-btn {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    font-size: 18px;
}

.routine-nav-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
}

.routine-nav-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    transform: none;
}

.routine-nav-btn:disabled:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: none;
}

.routine-date-display {
    text-align: center;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.routine-date-title {
    font-size: 20px;
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.routine-date-title i {
    color: #cbd5e0;
}

.routine-nav-dots {
    display: flex;
    gap: 8px;
    margin-top: 10px;
}

.routine-nav-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
}

.routine-nav-dot.active {
    background: rgba(255, 255, 255, 0.9);
    transform: scale(1.3);
}

/* Routine Cards Container */
.routine-cards-container {
    flex: 1;
    overflow: hidden; /* Change from auto to hidden for scroller */
    padding-right: 0;
    width: 100%;
    position: relative;
}

.routine-day-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 0; /* Remove margin for scroller */
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: transform 0.5s ease;
    min-height: 80px;
    height: auto;
    width: 100%; /* Full width for scroller */
    flex-shrink: 0; /* Prevent shrinking in scroller */
}

/* Routine scroller wrapper */
.routine-cards-scroller {
    display: flex;
    transition: transform 0.5s ease;
    width: 100%;
    height: 100%;
}

.routine-day-card:hover {
    transform: translateY(-5px);
}
.routine-day-card:hover {
    transform: translateY(-5px);
}

.routine-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.routine-card-date {
    font-weight: 700;
    color: white;
    display: flex;
    align-items: center;
    gap: 8px;
}

.routine-card-status {
    font-size: 14px;
    font-weight: 600;
    padding: 4px 12px;
    border-radius: 20px;
}

.status-completed {
    background: rgba(72, 187, 120, 0.2);
    color: #48bb78;
    border: 1px solid rgba(72, 187, 120, 0.3);
}

.status-incomplete {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.3);
}

.routine-table {
    width: 100%;
    border-collapse: collapse;
}

.routine-table th {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    font-weight: 600;
    padding: 12px 10px;
    text-align: left;
    border-bottom: 2px solid rgba(255, 255, 255, 0.2);
}

.routine-table td {
    padding: 12px 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    font-weight: 500;
}

.routine-table tr:last-child td {
    border-bottom: none;
}

.routine-table tr:hover td {
    background: rgba(255, 255, 255, 0.05);
}

/* Hide desktop table and mobile routine in non-expanded view */
.desktop-table, .mobile-routine {
    display: none;
}
/* Add gap between modal header and first routine card */
.modal-routine-container {
    padding: 20px 30px 30px 30px; /* Increased top padding from 0 to 20px */
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
    overflow-y: auto;
    flex-grow: 1;
    max-height: calc(80vh - 80px);
}
.badge-container {
    position: absolute;
    top: 8px;
    right: 8px;
    display: flex;
    gap: 3px;
}

.badge {
    font-size: 9px;
    padding: 2px 5px;
    border-radius: 8px;
    font-weight: 700;
    text-transform: uppercase;
    background: #ff4d4d;
    color: white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}
@media (max-width: 768px) {
    .profile-modal-content {
        width: 85%;
        margin: 0 auto;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
    }
}@media (max-width: 768px) {
    .confirmation-modal-content {
        width: 85%;
        margin: 0 auto;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
    }
}

/* Red color for remove photo button */
.profile-modal-btn.secondary.remove {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.3);
}

.profile-modal-btn.secondary.remove:hover {
    background: rgba(239, 68, 68, 0.3);
    color: #fca5a5;
}

/* Add animation classes to profile modal */
.profile-modal.fade-in {
    animation: fadeIn 0.3s ease;
}

.profile-modal.fade-out {
    animation: fadeOut 0.3s ease;
}

.profile-modal-content.scale-in {
    animation: scaleIn 0.3s ease;
}

.profile-modal-content.scale-out {
    animation: scaleOut 0.3s ease;
}

@media (max-width: 768px) {
    .profile-modal-content,
    .confirmation-modal-content {
        width: 85%;
        margin: 0 auto;
        /* Remove the transform properties that conflict with animations */
    }
}

/* Ensure modal content is always centered */
.profile-modal-content,
.confirmation-modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}
/* Image Section Styles */
.image-container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.image-container:hover {
    transform: scale(1.02);
}

.notice-image {
    max-width: 100%;
    max-height: 400px;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.1);
    object-fit: contain;
    transition: all 0.3s ease;
    cursor: pointer;
}

.notice-image:hover {
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

/* Image Modal Styles */
.image-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 2000;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.image-modal.fade-in {
    animation: fadeIn 0.3s ease;
}

.image-modal.fade-out {
    animation: fadeOut 0.3s ease;
}

.image-modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 20, 30, 0.95);
    padding: 0;
    border-radius: 20px;
    width: 95%;
    max-width: 900px;
    max-height: 90vh;
    overflow: hidden;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    flex-direction: column;
}

.image-modal-content.scale-in {
    animation: scaleIn 0.3s ease;
}

.image-modal-content.scale-out {
    animation: scaleOut 0.3s ease;
}

.image-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 30px 15px 30px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(20, 20, 30, 0.98);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
}

.image-modal-title {
    font-size: 24px;
    font-weight: 700;
    color: white;
    margin: 0;
}

.image-close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 28px;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.image-close-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.1);
}

.image-modal-body {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 30px;
    overflow: auto;
}

.modal-image {
    max-width: 100%;
    max-height: 100%;
    border-radius: 10px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    object-fit: contain;
}

/* Responsive adjustments for image section */
@media (max-width: 768px) {
    .notice-image {
        max-height: 300px;
    }
    
    .image-container {
        padding: 15px;
    }
    
    .image-modal-content {
        width: 98%;
        max-height: 85vh;
    }
    
    .image-modal-header {
        padding: 15px 20px 10px 20px;
    }
    
    .image-modal-body {
        padding: 20px;
    }
    
    .image-modal-title {
        font-size: 20px;
    }
}

@media (max-width: 480px) {
    .notice-image {
        max-height: 250px;
    }
    
    .image-container {
        padding: 10px;
    }
    
    .image-modal-content {
        width: 99%;
        max-height: 80vh;
        border-radius: 15px;
    }
    
    .image-modal-header {
        padding: 12px 15px 8px 15px;
    }
    
    .image-modal-body {
        padding: 15px;
    }
    
    .image-modal-title {
        font-size: 18px;
    }
    
    .image-close-btn {
        width: 35px;
        height: 35px;
        font-size: 24px;
    }
}

/* Animation keyframes (reuse existing ones) */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

@keyframes scaleIn {
    from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
    to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}

@keyframes scaleOut {
    from { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    to { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
}
/* New Routine Card Styles */
.routine-classes-container {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 15px;
}

.class-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.class-card:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.class-header {
    display: flex;
    align-items: center;
    gap: 15px;
}

.subject-icon {
    font-size: 28px;
    width: 35px;
    text-align: center;
    flex-shrink: 0;
}

.class-info {
    flex: 1;
    min-width: 0;
}

.class-topic {
    font-size: 16px;
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 4px;
    line-height: 1.4;
}

.class-subject {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.7);
    font-weight: 500;
}

.no-classes-message {
    text-align: center;
    padding: 30px 20px;
    color: #a0aec0;
}

.no-classes-message i {
    font-size: 40px;
    margin-bottom: 10px;
    display: block;
    opacity: 0.7;
}

.no-classes-message p {
    margin: 0;
    font-size: 16px;
}

/* Status styles */
.completed {
    color: #48bb78;
}

.today {
    color: #feca57;
}

.upcoming {
    color: #ef4444;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .class-card {
        padding: 12px;
    }
    
    .subject-icon {
        font-size: 24px;
        width: 30px;
    }
    
    .class-topic {
        font-size: 15px;
    }
    
    .class-subject {
        font-size: 13px;
    }
}

@media (max-width: 480px) {
    .class-card {
        padding: 10px;
    }
    
    .subject-icon {
        font-size: 22px;
        width: 28px;
    }
    
    .class-header {
        gap: 12px;
    }
    
    .class-topic {
        font-size: 14px;
    }
    
    .class-subject {
        font-size: 12px;
    }
}
/* Modal Search Styles */
.modal-search-container {
    margin: 10px 0 15px 0;
    position: relative;
    width: 100%;
}

.modal-search-box {
    width: 100%;
    padding: 14px 50px 14px 20px;
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    color: #ffffff;
    font-size: 16px;
    font-weight: 500;
    backdrop-filter: blur(15px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    outline: none;
}

.modal-search-box:focus {
    background: rgba(255, 255, 255, 0.12);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
}

.modal-search-box::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

.modal-search-controls {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    gap: 8px;
}

.modal-clear-search {
    background: rgba(255, 255, 255, 0.15);
    border: none;
    color: rgba(255, 255, 255, 0.8);
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    font-size: 14px;
}

.modal-clear-search:hover {
    background: rgba(255, 255, 255, 0.25);
    color: rgba(255, 255, 255, 1);
    transform: scale(1.1);
}

.modal-search-icon {
    color: rgba(255, 255, 255, 0.7);
    font-size: 18px;
}
/* Fix modal header spacing */
.modal-header {
    padding: 20px 30px 15px 30px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    position: sticky;
    top: 0;
    background: rgba(20, 20, 30, 0.98);
    z-index: 100;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.modal-title-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
}

.modal-title {
    font-size: 24px;
    font-weight: 700;
    color: white;
    margin: 0;
}

/* Fix modal container height */
.modal-routine-container {
    padding: 15px 30px 30px 30px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    overflow-y: auto;
    max-height: calc(85vh - 150px);
    height: auto;
}

/* Ensure routine cards are properly styled in modal */
.routine-day-card {
    width: 100%;
    margin-bottom: 0;
}

/* Fix search bar styling */
.modal-search-container {
    width: 100%;
    position: relative;
    margin: 0;
}

.modal-search-box {
    width: 100%;
    padding: 12px 50px 12px 20px;
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    color: #ffffff;
    font-size: 16px;
    font-weight: 500;
    backdrop-filter: blur(15px);
    transition: all 0.3s ease;
    outline: none;
}

.modal-search-box:focus {
    background: rgba(255, 255, 255, 0.12);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
}

.modal-search-controls {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    gap: 8px;
}

.modal-clear-search {
    background: rgba(255, 255, 255, 0.15);
    border: none;
    color: rgba(255, 255, 255, 0.8);
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
}

.modal-clear-search:hover {
    background: rgba(255, 255, 255, 0.25);
    color: white;
}

.modal-search-icon {
    color: rgba(255, 255, 255, 0.7);
    font-size: 18px;
}

/* Fix close button */
.close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 28px;
    cursor: pointer;
    transition: transform 0.3s ease;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    flex-shrink: 0;
}

.close-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.1);
}

/* Ensure class cards display properly */
.class-card {
    width: 100%;
    margin-bottom: 0;
}

.class-topic {
    word-wrap: break-word;
    word-break: break-word;
}

/* Fix for empty state */
.no-classes-message {
    text-align: center;
    padding: 40px 20px;
    color: rgba(255, 255, 255, 0.6);
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    border: 1px dashed rgba(255, 255, 255, 0.1);
}

/* Responsive fixes */
@media (max-width: 768px) {
    .modal-content {
        width: 95%;
        max-height: 90vh;
    }
    
    .modal-header {
        padding: 15px 20px 10px 20px;
    }
    
    .modal-routine-container {
        padding: 10px 20px 20px 20px;
        max-height: calc(90vh - 130px);
    }
    
    .modal-title {
        font-size: 20px;
    }
    
    .modal-search-box {
        padding: 10px 45px 10px 15px;
        font-size: 14px;
    }
    
    .close-btn {
        width: 35px;
        height: 35px;
        font-size: 24px;
    }
}

@media (max-width: 480px) {
    .modal-content {
        width: 98%;
        border-radius: 15px;
    }
    
    .modal-header {
        padding: 12px 15px 8px 15px;
    }
    
    .modal-routine-container {
        padding: 8px 15px 15px 15px;
        max-height: calc(90vh - 110px);
        gap: 15px;
    }
    
    .modal-title {
        font-size: 18px;
    }
    
    .modal-search-box {
        padding: 8px 40px 8px 12px;
        font-size: 13px;
    }
    
    .class-topic {
        font-size: 14px;
    }
    
    .class-subject {
        font-size: 12px;
    }
}
.logo-text i.fa-home {
    color: #ff4444; /* Red color */
    font-size: 38px;
}
.verified-badge {
    width: 26px;
    height: 26px;
    margin-left: 8px !important;
    vertical-align: middle;
    display: inline-block;
    margin-left: 4px !important;
    filter: none !important;
    transition: transform 0.3s ease !important;
    border-radius: 0 !important; /* Remove border-radius */
    background: none !important; /* Remove white background */
    padding: 0 !important; /* Remove padding */
    box-shadow: none !important; /* Remove box-shadow */
    position: relative !important;
}

.verified-badge:hover {
    transform: scale(1.1) !important;
    filter: brightness(1.1) !important;
}

/* Remove all animations */
@keyframes none {
    0%, 100% { transform: none; }
}

/* Ensure user-name displays properly */
.user-name {
    font-size: 30px;
    font-weight: 700;
    color: #ffffff;
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 6px;
    position: relative; /* Add this */
}

.user-name span {
    display: inline-block !important;
    vertical-align: middle !important;
}


/* Pre-load badge styles to prevent FOUC (Flash of Unstyled Content) */
.user-name::after {
    content: '';
    display: none; /* Hidden by default, shown by JS */
    width: 24px;
    height: 24px;
    background-image: url('https://img.icons8.com/fluency/48/instagram-verification-badge.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    margin-left: 4px;
}

/* Force immediate display of badge */
#userName .verified-badge {
    display: inline-block !important;
    opacity: 1 !important;
    visibility: visible !important;
    animation: none !important;
}
/* Cropping Modal Styles */
.cropping-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 4000;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.cropping-modal.fade-in {
    animation: fadeIn 0.3s ease;
}

.cropping-modal.fade-out {
    animation: fadeOut 0.3s ease;
}

.cropping-modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 20, 30, 0.95);
    padding: 25px;
    border-radius: 20px;
    width: 95%;
    max-width: 600px;
    max-height: 85vh;
    overflow: hidden;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    flex-direction: column;
}

.cropping-modal-content.scale-in {
    animation: scaleIn 0.3s ease;
}

.cropping-modal-content.scale-out {
    animation: scaleOut 0.3s ease;
}

.cropping-modal-title {
    font-size: 24px;
    font-weight: 700;
    color: white;
    margin-bottom: 20px;
    text-align: center;
}

.cropper-container {
    flex: 1;
    min-height: 300px;
    max-height: 400px;
    overflow: hidden;
    border-radius: 10px;
    margin-bottom: 20px;
    position: relative;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
}

.cropping-controls {
    margin-bottom: 20px;
    padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
}

.zoom-controls {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
}

.zoom-btn {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.zoom-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
}

#zoomSlider {
    flex: 1;
    height: 8px;
    -webkit-appearance: none;
    appearance: none;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    outline: none;
}

#zoomSlider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #ffffff;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

#zoomSlider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #ffffff;
    cursor: pointer;
    border: none;
}

.aspect-ratio-controls {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
}

.aspect-btn {
    padding: 8px 15px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.aspect-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.aspect-btn.active {
    background: rgba(255, 255, 255, 0.9);
    color: #1a202c;
}

.cropping-modal-buttons {
    display: flex;
    gap: 15px;
}

.cropping-modal-btn {
    flex: 1;
    padding: 15px;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 16px;
}

.cropping-modal-btn.primary {
    background: rgba(255, 255, 255, 0.9);
    color: #1a202c;
}

.cropping-modal-btn.primary:hover {
    background: white;
    transform: translateY(-2px);
}

.cropping-modal-btn.secondary {
    background: rgba(255, 255, 255, 0.1);
    color: white;
}

.cropping-modal-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .cropping-modal-content {
        padding: 20px;
        width: 98%;
        max-height: 90vh;
    }
    
    .cropper-container {
        min-height: 250px;
        max-height: 350px;
    }
    
    .zoom-controls {
        gap: 10px;
    }
    
    .zoom-btn {
        width: 35px;
        height: 35px;
    }
}

@media (max-width: 480px) {
    .cropping-modal-content {
        padding: 15px;
    }
    
    .cropping-modal-title {
        font-size: 20px;
    }
    
    .cropper-container {
        min-height: 200px;
        max-height: 300px;
    }
    
    .cropping-controls {
        padding: 12px;
    }
    
    .aspect-btn {
        padding: 6px 12px;
        font-size: 14px;
    }
    
    .cropping-modal-btn {
        padding: 12px;
        font-size: 14px;
    }
}
/* Profile Picture Viewer Modal */
.profile-viewer-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 5000;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.profile-viewer-modal.fade-in {
    animation: fadeIn 0.3s ease;
}

.profile-viewer-modal.fade-out {
    animation: fadeOut 0.3s ease;
}

.profile-viewer-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 20, 30, 0.95);
    padding: 0;
    border-radius: 20px;
    width: 95%;
    max-width: 600px;
    max-height: 90vh;
    overflow: hidden;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    flex-direction: column;
}

.profile-viewer-content.scale-in {
    animation: scaleIn 0.3s ease;
}

.profile-viewer-content.scale-out {
    animation: scaleOut 0.3s ease;
}

.profile-viewer-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 30px 15px 30px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(20, 20, 30, 0.98);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
}

.profile-viewer-title {
    font-size: 24px;
    font-weight: 700;
    color: white;
    margin: 0;
}

.profile-viewer-close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 28px;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.profile-viewer-close-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.1);
}

.profile-viewer-body {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 30px;
    overflow: auto;
}

.full-profile-picture {
    max-width: 100%;
    max-height: 100%;
    border-radius: 10px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    object-fit: contain;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .profile-viewer-content {
        width: 98%;
        max-height: 85vh;
    }
    
    .profile-viewer-header {
        padding: 15px 20px 10px 20px;
    }
    
    .profile-viewer-body {
        padding: 20px;
    }
    
    .profile-viewer-title {
        font-size: 20px;
    }
}

@media (max-width: 480px) {
    .profile-viewer-content {
        width: 99%;
        max-height: 80vh;
        border-radius: 15px;
    }
    
    .profile-viewer-header {
        padding: 12px 15px 8px 15px;
    }
    
    .profile-viewer-body {
        padding: 15px;
    }
    
    .profile-viewer-title {
        font-size: 18px;
    }
    
    .profile-viewer-close-btn {
        width: 35px;
        height: 35px;
        font-size: 24px;
    }
}
/* Settings Icon Styles */
.settings-container {
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 1001;
}

.settings-icon {
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 22px;
    color: white;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.settings-icon:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    color: #ff4444;
}

.settings-icon:active {
    transform: translateY(0) scale(0.95);
}

/* Settings Dropdown */
.settings-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 10px;
    background: rgba(20, 20, 30, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 15px;
    min-width: 200px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.1);
    overflow: hidden;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1002;
}

.settings-dropdown.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.dropdown-item {
    padding: 15px 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    color: white;
    font-weight: 500;
}

.dropdown-item:last-child {
    border-bottom: none;
}

.dropdown-item:hover {
    background: rgba(255, 255, 255, 0.1);
    padding-left: 25px;
}

.dropdown-item i {
    font-size: 16px;
    color: #ff4444;
    width: 20px;
    text-align: center;
}

/* My Profile Modal Styles */
.profile-settings-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 3000;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.profile-settings-modal.fade-in {
    animation: fadeIn 0.3s ease;
}

.profile-settings-modal.fade-out {
    animation: fadeOut 0.3s ease;
}

.profile-settings-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20, 20, 30, 0.95);
    padding: 0;
    border-radius: 20px;
    width: 95%;
    max-width: 500px;
    max-height: 90vh;
    overflow: hidden;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    flex-direction: column;
}

.profile-settings-content.scale-in {
    animation: scaleIn 0.3s ease;
}

.profile-settings-content.scale-out {
    animation: scaleOut 0.3s ease;
}

.profile-settings-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 30px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(20, 20, 30, 0.98);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
}

.profile-settings-title {
    font-size: 24px;
    font-weight: 700;
    color: white;
    margin: 0;
}

.profile-settings-close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 28px;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.profile-settings-close-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.1);
}

.profile-settings-body {
    flex: 1;
    padding: 30px;
    overflow-y: auto;
}

/* Profile Form Styles */
.profile-form {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.form-label-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.form-label {
    font-size: 16px;
    font-weight: 600;
    color: #ffffff;
    display: flex;
    align-items: center;
    gap: 10px;
}

.form-label i {
    color: #ff4444;
    font-size: 16px;
    width: 20px;
}

.edit-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    padding: 8px 15px;
    color: white;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.edit-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.edit-btn:active {
    transform: translateY(0);
}

.form-input-group {
    position: relative;
}

.form-input, .form-textarea {
    width: 100%;
    padding: 15px;
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    color: #ffffff;
    font-size: 16px;
    font-weight: 500;
    backdrop-filter: blur(15px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    outline: none;
    font-family: 'Hind Siliguri', sans-serif;
}

.form-textarea {
    resize: vertical;
    min-height: 100px;
    line-height: 1.6;
}

.form-input:read-only, .form-textarea:read-only {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
    cursor: default;
    color: rgba(255, 255, 255, 0.7);
}

.form-input:focus, .form-textarea:focus {
    background: rgba(255, 255, 255, 0.12);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
}

.field-status {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    gap: 6px;
    opacity: 0.7;
    transition: opacity 0.3s ease;
}

.verified-icon {
    color: #48bb78;
    font-size: 14px;
}

.status-text {
    font-size: 12px;
    color: #48bb78;
    font-weight: 600;
}

/* Save Button */
.save-btn-container {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.save-btn {
    width: 100%;
    padding: 18px;
    background: linear-gradient(135deg, #ff4444, #cc0000);
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 5px 15px rgba(255, 68, 68, 0.3);
}

.save-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(255, 68, 68, 0.4);
    background: linear-gradient(135deg, #ff5555, #dd0000);
}

.save-btn:active {
    transform: translateY(0);
}

.save-btn i {
    font-size: 18px;
}

/* Animation for editing mode */
.editing .form-input:not(:read-only),
.editing .form-textarea:not(:read-only) {
    animation: inputFocusGlow 2s infinite alternate;
}

@keyframes inputFocusGlow {
    0% {
        box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.4);
    }
    100% {
        box-shadow: 0 0 0 5px rgba(255, 68, 68, 0.1);
    }
}

/* Edit button active state */
.edit-btn.editing {
    background: rgba(255, 68, 68, 0.2);
    border-color: rgba(255, 68, 68, 0.3);
    color: #ff4444;
}

.edit-btn.editing .edit-text {
    display: none;
}

.edit-btn.editing::after {
    content: 'Editing';
    font-weight: 600;
}

/* Responsive Design */
@media (max-width: 768px) {
    .settings-icon {
        width: 45px;
        height: 45px;
        font-size: 20px;
        right: 15px;
    }
    
    .settings-dropdown {
        min-width: 180px;
    }
    
    .profile-settings-content {
        width: 90%;
        max-height: 85vh;
    }
    
    .profile-settings-header {
        padding: 15px 20px;
    }
    
    .profile-settings-body {
        padding: 20px;
    }
    
    .profile-settings-title {
        font-size: 20px;
    }
    
    .form-input, .form-textarea {
        padding: 12px;
        font-size: 15px;
    }
    
    .save-btn {
        padding: 16px;
        font-size: 15px;
    }
}

@media (max-width: 480px) {
    .settings-container {
        right: 10px;
    }
    
    .settings-icon {
        width: 40px;
        height: 40px;
        font-size: 18px;
    }
    
    .profile-settings-content {
        width: 95%;
        border-radius: 15px;
        max-height: 90vh;
    }
    
    .profile-settings-header {
        padding: 12px 15px;
    }
    
    .profile-settings-body {
        padding: 15px;
    }
    
    .profile-settings-title {
        font-size: 18px;
    }
    
    .profile-settings-close-btn {
        width: 35px;
        height: 35px;
        font-size: 24px;
    }
    
    .form-label {
        font-size: 14px;
    }
    
    .edit-btn {
        padding: 6px 12px;
        font-size: 12px;
    }
    
    .form-input, .form-textarea {
        padding: 10px;
        font-size: 14px;
    }
    
    .save-btn {
        padding: 14px;
        font-size: 14px;
    }
}
/* Profile Picture Field Styles */
.profile-picture-field {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-top: 10px;
}

.profile-picture-preview {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    overflow: hidden;
    cursor: pointer;
    background: rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
}

.profile-picture-preview:hover {
    border-color: rgba(255, 255, 255, 0.4);
    transform: scale(1.05);
}

.profile-picture-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.profile-preview-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
}

.profile-picture-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    justify-content: center;
}

.profile-picture-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

.profile-picture-btn.remove {
    background: rgba(239, 68, 68, 0.1);
    border-color: rgba(239, 68, 68, 0.3);
    color: #ef4444;
}

.profile-picture-btn.remove:hover {
    background: rgba(239, 68, 68, 0.2);
}
</style>
</head>
<body>
<!-- Fixed Header -->
<header class="header">
    <div class="header-content">
        <div class="logo-container">
            <div class="logo-text">
                <i class="fas fa-home"></i>
                Home
            </div>
<!-- Settings Icon -->
<div class="settings-container">
    <div class="settings-icon" id="settingsIcon">
        <i class="fas fa-cog"></i>
    </div>
    <div class="settings-dropdown" id="settingsDropdown">
        <div class="dropdown-item" id="myProfileBtn">
            <i class="fas fa-user"></i>
            <span>My Profile</span>
        </div>
        <!-- You can add more items here later -->
    </div>
</div>
        </div>
    </div>
</header>

<div class="container">
<!-- User Info Section -->
<section class="user-info-section">
    <div class="time-date">
        <div class="big-time" id="currentTime">
            <i class="fas fa-clock"></i>
            <span>Loading...</span>
        </div>
        <div class="date" id="currentDate">
            <i class="far fa-calendar-alt"></i>
            <span>Loading...</span>
        </div>
    </div>
    <div class="user-profile">
        <div class="user-details">
<div class="user-name" id="userName">
    <span>Loading...</span>
    <img src="https://img.icons8.com/fluency/48/instagram-verification-badge.png" 
         class="verified-badge"
         loading="eager" <!-- Add this -->
</div>
            <div class="short-text">Loading...</div>
        </div>
        <div class="profile-icon" id="profileIcon">
            <div class="profile-icon-placeholder" id="profilePlaceholder">
                <i class="fas fa-user"></i>
            </div>
            <input type="file" id="profilePictureInput" class="profile-picture-input" accept="image/*">
        </div>
    </div>
</section>

    <!-- Profile Picture Modal -->
    <div class="profile-modal" id="profileModal">
        <div class="profile-modal-content">
            <h2 class="profile-modal-title">Update Profile Picture</h2>
            <div class="profile-preview" id="profilePreview">
                <div class="profile-preview-placeholder">
                    <i class="fas fa-camera"></i>
                </div>
            </div>

            <input type="file" id="profileUploadInput" accept="image/*" style="display: none;">
            <div class="profile-modal-buttons">
                <button class="profile-modal-btn primary" id="choosePhotoBtn">Choose Photo</button>
                <button class="profile-modal-btn secondary" id="removePhotoBtn">Remove Photo</button>
                <button class="profile-modal-btn secondary" id="cancelProfileBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal (MOVED OUTSIDE profile-modal) -->
    <div class="confirmation-modal" id="confirmationModal">
        <div class="confirmation-modal-content">
            <h2 class="confirmation-modal-title">Confirm Removal</h2>
            <p class="confirmation-modal-message">Are you sure you want to remove your profile picture?</p>
            <div class="confirmation-modal-buttons">
                <button class="confirmation-modal-btn proceed" id="proceedRemoveBtn">Proceed</button>
                <button class="confirmation-modal-btn cancel" id="cancelRemoveBtn">Cancel</button>
            </div>
        </div>
    </div>
<!-- Cropping Modal -->
<div class="cropping-modal" id="croppingModal">
    <div class="cropping-modal-content">
        <h2 class="cropping-modal-title">Crop Profile Picture</h2>
        
        <div class="cropper-container">
            <img id="cropperImage" src="" alt="Image to crop" style="max-width: 100%;">
        </div>
        
        <div class="cropping-controls">
            <div class="zoom-controls">
                <button class="zoom-btn" id="zoomOutBtn" type="button">
                    <i class="fas fa-search-minus"></i>
                </button>
                <input type="range" id="zoomSlider" min="0.1" max="3" step="0.1" value="1">
                <button class="zoom-btn" id="zoomInBtn" type="button">
                    <i class="fas fa-search-plus"></i>
                </button>
            </div>
            
            <div class="aspect-ratio-controls">
                <button class="aspect-btn active" data-aspect="1">1:1</button>
                <button class="aspect-btn" data-aspect="1.5">3:2</button>
                <button class="aspect-btn" data-aspect="0.666">2:3</button>
                <button class="aspect-btn" data-aspect="free">Free</button>
            </div>
        </div>
        
        <div class="cropping-modal-buttons">
            <button class="cropping-modal-btn secondary" id="cancelCropBtn">Cancel</button>
            <button class="cropping-modal-btn primary" id="applyCropBtn">Apply</button>
        </div>
    </div>
</div>
<!-- Profile Picture Viewer Modal -->
<div class="profile-viewer-modal" id="profileViewerModal">
    <div class="profile-viewer-content">
        <div class="profile-viewer-header">
            <h2 class="profile-viewer-title">Profile Picture</h2>
            <button class="profile-viewer-close-btn" id="profileViewerCloseBtn">&times;</button>
        </div>
        <div class="profile-viewer-body">
            <img id="fullProfilePicture" src="" alt="Profile Picture" class="full-profile-picture">
        </div>
    </div>
</div>
<!-- My Profile Modal -->
<div class="profile-settings-modal" id="profileSettingsModal">
    <div class="profile-settings-content">
        <div class="profile-settings-header">
            <h2 class="profile-settings-title">My Profile</h2>
            <button class="profile-settings-close-btn" id="profileSettingsCloseBtn">&times;</button>
        </div>
        
        <div class="profile-settings-body">
            <div class="profile-form">
<!-- Profile Picture Field -->
<div class="form-group">
    <div class="form-label-row">
        <label class="form-label">
            <i class="fas fa-camera"></i>
            Profile Picture
        </label>
    </div>
    <div class="profile-picture-field" style="display: flex; align-items: center; gap: 20px;">
        <div class="profile-picture-preview" id="profileSettingsPreview" 
             style="width: 80px; height: 80px; border-radius: 50%; overflow: hidden; cursor: pointer; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center;">
            <div class="profile-preview-placeholder" style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">
                <i class="fas fa-user" style="font-size: 30px; color: rgba(255,255,255,0.5);"></i>
            </div>
        </div>
        <div style="display: flex; flex-direction: column; gap: 10px; flex: 1;">
            <button class="profile-picture-btn" id="changeProfilePictureBtn" 
                    style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s ease;">
                <i class="fas fa-edit"></i> Change Photo
            </button>
            <button class="profile-picture-btn remove" id="removeProfilePictureBtn"
                    style="background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); color: #ef4444; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; display: none;">
                <i class="fas fa-trash"></i> Remove Photo
            </button>
        </div>
    </div>
</div>
                <!-- Name Field -->
                <div class="form-group">
                    <div class="form-label-row">
                        <label class="form-label">
                            <i class="fas fa-user"></i>
                            Name
                        </label>
                        <button class="edit-btn" data-field="name">
                            <i class="fas fa-edit"></i>
                            <span class="edit-text">Edit</span>
                        </button>
                    </div>
                    <div class="form-input-group">
                        <input type="text" id="profileName" class="form-input" value="Student Name" readonly>
                        <div class="field-status">
                            <i class="fas fa-check-circle verified-icon"></i>
                            <span class="status-text"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Email Field -->
                <div class="form-group">
                    <div class="form-label-row">
                        <label class="form-label">
                            <i class="fas fa-envelope"></i>
                            Email
                        </label>
                        <button class="edit-btn" data-field="email">
                            <i class="fas fa-edit"></i>
                            <span class="edit-text">Edit</span>
                        </button>
                    </div>
                    <div class="form-input-group">
                        <input type="email" id="profileEmail" class="form-input" value="student@example.com" readonly>
                        <div class="field-status">
                            <i class="fas fa-check-circle verified-icon"></i>
                            <span class="status-text"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Motto Field -->
                <div class="form-group">
                    <div class="form-label-row">
                        <label class="form-label">
                            <i class="fas fa-quote-left"></i>
                            Motto
                        </label>
                        <button class="edit-btn" data-field="motto">
                            <i class="fas fa-edit"></i>
                            <span class="edit-text">Edit</span>
                        </button>
                    </div>
                    <div class="form-input-group">
                        <textarea id="profileMotto" class="form-textarea" rows="3" readonly>A student who never gave up.</textarea>
                        <div class="field-status">
                            <i class="fas fa-check-circle verified-icon"></i>
                            <span class="status-text"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Save Button (initially hidden) -->
                <div class="save-btn-container" id="saveBtnContainer" style="display: none;">
                    <button class="save-btn" id="saveProfileBtn">
                        <i class="fas fa-save"></i>
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
    <!-- PCMB Timer Section -->
    <div class="pcmb-timer" id="pcmbTimer">
        Loading...
    </div>

    <!-- Buttons Section -->
    <section class="buttons-section">
        <div class="buttons-grid">
            <a href="lec.html" class="cube-button" id="classroomBtn">
                <div class="button-icon">
                    <i class="fas fa-play-circle"></i>
                </div>
                <div class="button-name">Lectures</div>
            </a>
            
            <a href="mat.html" class="cube-button" id="materialsBtn">
                <div class="button-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <div class="button-name">Materials</div>
            </a>
            
            <a href="arc.html" class="cube-button" id="archivesBtn">
                <div class="button-icon">
                    <i class="fas fa-history"></i>
                </div>
                <div class="button-name">Archives</div>
            </a>
        </div>
    </section>

    <!-- Routine Section -->
    <section class="routine-section">
        <h2 class="section-title">Class Routine</h2>
        
        <!-- Routine Navigation -->
        <div class="routine-navigation">
            <button class="routine-nav-btn" id="prevDayBtn">
                <i class="fas fa-chevron-left"></i>
            </button>
            
            <div class="routine-date-display">
                <div class="routine-date-title" id="currentDayTitle">
                    <i class="far fa-calendar"></i>
                    <span id="dayDisplay">Today</span>
                </div>
                <div class="routine-nav-dots" id="routineNavDots">
                    <div class="routine-nav-dot active" data-day="0"></div>
                    <div class="routine-nav-dot" data-day="1"></div>
                </div>
            </div>
            
            <button class="routine-nav-btn" id="nextDayBtn">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <!-- Routine Cards Container -->
        <div class="routine-cards-container" id="routineCardsContainer">
            <!-- Today's classes will be inserted here by JavaScript -->
        </div>
        
        <button class="expand-btn" id="expandRoutineBtn">Check Routine</button>
    </section>

<!-- Modal for expanded routine view -->
<div class="modal" id="routineModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title-row">
                <h2 class="modal-title">Class Routine</h2>
                <button class="close-btn" id="closeModalBtn">&times;</button>
            </div>
            
            <!-- SEARCH BAR - ADD THIS -->
            <div class="modal-search-container">
                <input type="text" class="modal-search-box" id="modalSearchBox" placeholder="Search">
                <div class="modal-search-controls">
                    <button class="modal-clear-search" id="modalClearSearch" style="display: none;">
                        <i class="fas fa-times"></i>
                    </button>
                    <i class="modal-search-icon fas fa-search"></i>
                </div>
            </div>
        </div>
        
        <div class="modal-routine-container" id="modalRoutineContainer">
            <!-- Expanded routine cards will be inserted by JavaScript -->
        </div>
    </div>
</div>

<script src="data/cache3.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script>
// Function to update profile picture preview in settings modal
function updateProfileSettingsPreview() {
    const preview = document.getElementById('profileSettingsPreview');
    const removeBtn = document.getElementById('removeProfilePictureBtn');
    const savedPicture = localStorage.getItem('userProfilePicture');
    
    if (preview) {
        if (savedPicture) {
            // Check if image already exists in preview
            let existingImg = preview.querySelector('img');
            if (existingImg) {
                existingImg.src = savedPicture;
            } else {
                // Create new image
                preview.innerHTML = `<img src="${savedPicture}" alt="Profile Preview" style="width: 100%; height: 100%; object-fit: cover;">`;
            }
            
            // Make preview clickable to open viewer
            preview.onclick = function() {
                openProfileViewer(savedPicture);
            };
            
            // Show remove button
            if (removeBtn) {
                removeBtn.style.display = 'flex';
            }
        } else {
            // Show placeholder
            preview.innerHTML = `
                <div class="profile-preview-placeholder">
                    <i class="fas fa-user" style="font-size: 30px; color: rgba(255,255,255,0.5);"></i>
                </div>
            `;
            
            // Make preview clickable to open profile picture modal
            preview.onclick = function() {
                closeProfileSettingsModal();
                setTimeout(() => {
                    openProfileModal();
                }, 300);
            };
            
            // Hide remove button
            if (removeBtn) {
                removeBtn.style.display = 'none';
            }
        }
    }
}

// Function to setup profile picture functionality in settings modal
function setupProfilePictureInSettings() {
    const changeBtn = document.getElementById('changeProfilePictureBtn');
    const removeBtn = document.getElementById('removeProfilePictureBtn');
    const preview = document.getElementById('profileSettingsPreview');
    
    if (!changeBtn || !removeBtn || !preview) return;
    
    // Change photo button
    changeBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        closeProfileSettingsModal();
        setTimeout(() => {
            openProfileModal();
        }, 300);
    });
    
    // Remove photo button
    removeBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        
        // Show confirmation modal
        const confirmationModal = document.getElementById('confirmationModal');
        const confirmationModalContent = confirmationModal.querySelector('.confirmation-modal-content');
        
        if (confirmationModal) {
            // Open confirmation modal
            confirmationModal.classList.remove('fade-out');
            confirmationModalContent.classList.remove('scale-out');
            confirmationModal.style.display = 'block';
            
            void confirmationModal.offsetWidth;
            
            confirmationModal.classList.add('fade-in');
            confirmationModalContent.classList.add('scale-in');
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
            
            // Handle proceed button
            const proceedBtn = document.getElementById('proceedRemoveBtn');
            if (proceedBtn) {
                const originalClickHandler = proceedBtn.onclick;
                proceedBtn.onclick = function() {
                    // Remove profile picture
                    localStorage.removeItem('userProfilePicture');
                    
                    // Update main profile picture
                    updateProfilePicture(null);
                    
                    // Update preview in settings modal
                    updateProfileSettingsPreview();
                    
                    // Clear session storage
                    sessionStorage.removeItem('profilePicture');
                    sessionStorage.removeItem('profilePictureURL');
                    
                    // Show notification
                    showNotification('Profile picture removed successfully!', 'success');
                    
                    // Close confirmation modal
                    closeModal(confirmationModal, confirmationModalContent);
                    
                    // Reopen profile settings modal after delay
                    setTimeout(() => {
                        openProfileSettingsModal();
                    }, 300);
                };
                
                // Restore original handler after use
                setTimeout(() => {
                    proceedBtn.onclick = originalClickHandler;
                }, 1000);
            }
        }
    });
    
    // Preview click handler
    preview.addEventListener('click', function() {
        const savedPicture = localStorage.getItem('userProfilePicture');
        if (savedPicture) {
            // Open viewer if picture exists
            openProfileViewer(savedPicture);
        } else {
            // Open profile modal if no picture
            closeProfileSettingsModal();
            setTimeout(() => {
                openProfileModal();
            }, 300);
        }
    });
    
    // Initialize preview
    updateProfileSettingsPreview();
}

// Function to open profile picture modal
function openProfileModal() {
    const modal = document.getElementById('profileModal');
    const content = modal.querySelector('.profile-modal-content');
    const profilePreview = document.getElementById('profilePreview');
    const choosePhotoBtn = document.getElementById('choosePhotoBtn');
    const removePhotoBtn = document.getElementById('removePhotoBtn');
    
    if (!modal || !content) return;
    
    // Reset animation classes
    modal.classList.remove('fade-out');
    content.classList.remove('scale-out');
    
    // Show modal
    modal.style.display = 'block';
    
    // Force reflow
    void modal.offsetWidth;
    
    // Add animation classes
    modal.classList.add('fade-in');
    content.classList.add('scale-in');
    
    // Update preview with current picture
    const savedPicture = localStorage.getItem('userProfilePicture');
    if (profilePreview) {
        if (savedPicture) {
            profilePreview.innerHTML = `
                <img src="${savedPicture}" 
                     class="profile-preview-img" 
                     alt="Profile Preview"
                     style="cursor: pointer;"
                     onclick="openProfileViewer('${savedPicture}')">
            `;
            if (choosePhotoBtn) choosePhotoBtn.textContent = 'Change Photo';
            if (removePhotoBtn) {
                removePhotoBtn.style.display = 'block';
                removePhotoBtn.classList.add('remove');
            }
        } else {
            profilePreview.innerHTML = `<div class="profile-preview-placeholder"><i class="fas fa-upload"></i></div>`;
            if (choosePhotoBtn) choosePhotoBtn.textContent = 'Choose Photo';
            if (removePhotoBtn) {
                removePhotoBtn.style.display = 'none';
                removePhotoBtn.classList.remove('remove');
            }
        }
    }
    
    // Prevent body scroll
    document.body.style.overflow = 'hidden';
}

// Function to close profile modal
function closeProfileModal() {
    const modal = document.getElementById('profileModal');
    const content = modal.querySelector('.profile-modal-content');
    
    if (!modal || !content) return;
    
    modal.classList.remove('fade-in');
    content.classList.remove('scale-in');
    modal.classList.add('fade-out');
    content.classList.add('scale-out');
    
    setTimeout(() => {
        if (modal.classList.contains('fade-out')) {
            modal.style.display = 'none';
            document.body.style.overflow = '';
        }
    }, 300);
}
// Settings Dropdown Functionality
function setupSettingsDropdown() {
    const settingsIcon = document.getElementById('settingsIcon');
    const settingsDropdown = document.getElementById('settingsDropdown');
    const myProfileBtn = document.getElementById('myProfileBtn');
    
    if (!settingsIcon || !settingsDropdown || !myProfileBtn) {
        console.warn('Settings elements not found');
        return;
    }
    
    // Toggle dropdown when settings icon is clicked
    settingsIcon.addEventListener('click', function(e) {
        e.stopPropagation();
        settingsDropdown.classList.toggle('show');
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
        if (!settingsDropdown.contains(e.target) && !settingsIcon.contains(e.target)) {
            settingsDropdown.classList.remove('show');
        }
    });
    
    // My Profile button click handler
    myProfileBtn.addEventListener('click', function() {
        settingsDropdown.classList.remove('show');
        openProfileSettingsModal();
    });
}

// My Profile Modal Functionality
function setupProfileSettingsModal() {
    const profileModal = document.getElementById('profileSettingsModal');
    const profileContent = profileModal.querySelector('.profile-settings-content');
    const closeBtn = document.getElementById('profileSettingsCloseBtn');
    const editBtns = document.querySelectorAll('.edit-btn');
    const saveBtnContainer = document.getElementById('saveBtnContainer');
    const saveBtn = document.getElementById('saveProfileBtn');
    const nameInput = document.getElementById('profileName');
    const emailInput = document.getElementById('profileEmail');
    const mottoInput = document.getElementById('profileMotto');
    
    if (!profileModal || !profileContent || !closeBtn) {
        console.warn('Profile settings modal elements not found');
        return;
    }
    
    // Load saved profile data immediately
    setTimeout(() => {
        loadProfileData();
    }, 100);
    
    // Close modal
    closeBtn.addEventListener('click', function() {
        closeProfileSettingsModal();
    });
    
    // Close when clicking outside
    profileModal.addEventListener('click', function(e) {
        if (e.target === profileModal) {
            closeProfileSettingsModal();
        }
    });
    
    // Close with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && profileModal.style.display === 'block') {
            closeProfileSettingsModal();
        }
    });
    
    // Edit button functionality
    editBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const field = this.dataset.field;
            enableEditing(field);
        });
    });
    
    // Save button functionality
    if (saveBtn) {
        saveBtn.addEventListener('click', function() {
            saveProfileData();
        });
    }
    
    function enableEditing(field) {
        let input;
        let editBtn;
        
        switch(field) {
            case 'name':
                input = nameInput;
                editBtn = document.querySelector('.edit-btn[data-field="name"]');
                break;
            case 'email':
                input = emailInput;
                editBtn = document.querySelector('.edit-btn[data-field="email"]');
                break;
            case 'motto':
                input = mottoInput;
                editBtn = document.querySelector('.edit-btn[data-field="motto"]');
                break;
        }
        
        if (!input) return;
        
        // Toggle editing mode
        const isEditing = input.hasAttribute('readonly');
        
        if (isEditing) {
            // Enable editing
            input.removeAttribute('readonly');
            input.classList.add('editing');
            editBtn.classList.add('editing');
            editBtn.querySelector('.edit-text').textContent = 'Cancel';
            
            // Focus on input
            input.focus();
            
            // Show save button
            if (saveBtnContainer) {
                saveBtnContainer.style.display = 'block';
            }
        } else {
            // Cancel editing
            input.setAttribute('readonly', true);
            input.classList.remove('editing');
            editBtn.classList.remove('editing');
            editBtn.querySelector('.edit-text').textContent = 'Edit';
            
            // Revert to saved value
            const savedData = getProfileData();
            if (savedData) {
                input.value = savedData[field] || input.defaultValue;
            }
            
            // Hide save button if no fields are being edited
            const anyEditing = document.querySelectorAll('.form-input:not([readonly]), .form-textarea:not([readonly])');
            if (saveBtnContainer && anyEditing.length === 0) {
                saveBtnContainer.style.display = 'none';
            }
        }
    }
    
    // Auto-hide save button when all fields are readonly
    function checkEditingState() {
        const anyEditing = document.querySelectorAll('.form-input:not([readonly]), .form-textarea:not([readonly])');
        if (saveBtnContainer) {
            saveBtnContainer.style.display = anyEditing.length > 0 ? 'block' : 'none';
        }
    }
    
    // Listen for input changes to update save button state
    [nameInput, emailInput, mottoInput].forEach(input => {
        if (input) {
            input.addEventListener('input', checkEditingState);
        }
    });
}

function openProfileSettingsModal() {
    const modal = document.getElementById('profileSettingsModal');
    const content = modal.querySelector('.profile-settings-content');
    
    if (!modal || !content) return;
    
    // Reset all fields to readonly
    const inputs = document.querySelectorAll('.form-input, .form-textarea');
    const editBtns = document.querySelectorAll('.edit-btn');
    
    inputs.forEach(input => {
        input.setAttribute('readonly', true);
        input.classList.remove('editing');
    });
    
    editBtns.forEach(btn => {
        btn.classList.remove('editing');
        const editText = btn.querySelector('.edit-text');
        if (editText) {
            editText.textContent = 'Edit';
        }
    });
    
    // Hide save button
    const saveBtnContainer = document.getElementById('saveBtnContainer');
    if (saveBtnContainer) {
        saveBtnContainer.style.display = 'none';
    }
    
    // Load fresh data
    loadProfileData();
    
    // Show modal with animation
    modal.classList.remove('fade-out');
    content.classList.remove('scale-out');
    modal.style.display = 'block';
    
    void modal.offsetWidth;
    
    modal.classList.add('fade-in');
    content.classList.add('scale-in');
    
    // Prevent body scroll
    document.body.style.overflow = 'hidden';
    
    // ADD THIS LINE: Update profile picture preview
    updateProfileSettingsPreview();
}

function closeProfileSettingsModal() {
    const modal = document.getElementById('profileSettingsModal');
    const content = modal.querySelector('.profile-settings-content');
    
    if (!modal || !content) return;
    
    modal.classList.remove('fade-in');
    content.classList.remove('scale-in');
    modal.classList.add('fade-out');
    content.classList.add('scale-out');
    
    setTimeout(() => {
        if (modal.classList.contains('fade-out')) {
            modal.style.display = 'none';
            document.body.style.overflow = '';
        }
    }, 300);
}

// Profile Data Management
function loadProfileData() {
    const savedData = getProfileData();
    
    if (savedData) {
        const nameInput = document.getElementById('profileName');
        const emailInput = document.getElementById('profileEmail');
        const mottoInput = document.getElementById('profileMotto');
        const userNameElement = document.getElementById('userName')?.querySelector('span');
        
        // Load from localStorage first, then from saved profile data
        const storedName = localStorage.getItem('userName') || savedData.name;
        const storedEmail = localStorage.getItem('userGmail') || savedData.email;
        const storedMotto = savedData.motto;
        
        if (nameInput && storedName) {
            nameInput.value = storedName;
            if (userNameElement) {
                userNameElement.textContent = storedName;
            }
        }
        
        if (emailInput && storedEmail) {
            emailInput.value = storedEmail;
        }
        
        if (mottoInput && storedMotto) {
            mottoInput.value = storedMotto;
            // Update the motto in user info section
            const userMottoElement = document.querySelector('.short-text');
            if (userMottoElement) {
                userMottoElement.textContent = storedMotto;
            }
        }
    }
}

function getProfileData() {
    try {
        const storedData = localStorage.getItem('profileSettings');
        if (storedData) {
            return JSON.parse(storedData);
        }
        
        // Return default values if no data exists
        return {
            name: localStorage.getItem('userName') || 'Student Name',
            email: localStorage.getItem('userGmail') || 'student@example.com',
            motto: 'A student who never gave up.'
        };
    } catch (error) {
        console.error('Error loading profile data:', error);
        return {
            name: localStorage.getItem('userName') || 'Student Name',
            email: localStorage.getItem('userGmail') || 'student@example.com',
            motto: 'A student who never gave up.'
        };
    }
}

function saveProfileData() {
    const nameInput = document.getElementById('profileName');
    const emailInput = document.getElementById('profileEmail');
    const mottoInput = document.getElementById('profileMotto');
    
    if (!nameInput || !emailInput || !mottoInput) return;
    
    const profileData = {
        name: nameInput.value.trim(),
        email: emailInput.value.trim(),
        motto: mottoInput.value.trim()
    };
    
    // Validate data
    if (!profileData.name) {
        showNotification('Please enter your name', 'error');
        nameInput.focus();
        return;
    }
    
    if (!profileData.email || !isValidEmail(profileData.email)) {
        showNotification('Please enter a valid email address', 'error');
        emailInput.focus();
        return;
    }
    
    if (!profileData.motto) {
        showNotification('Please enter your motto', 'error');
        mottoInput.focus();
        return;
    }
    
    try {
        // Save to localStorage
        localStorage.setItem('profileSettings', JSON.stringify(profileData));
        
        // Update the main page display
        const userNameElement = document.getElementById('userName')?.querySelector('span');
        if (userNameElement) {
            userNameElement.textContent = profileData.name;
        }
        
        const userMottoElement = document.querySelector('.short-text');
        if (userMottoElement) {
            userMottoElement.textContent = profileData.motto;
        }
        
        // Also update access verification data
        localStorage.setItem('userName', profileData.name);
        localStorage.setItem('userGmail', profileData.email);
        
        // Set all fields back to readonly
        const inputs = document.querySelectorAll('.form-input, .form-textarea');
        const editBtns = document.querySelectorAll('.edit-btn');
        
        inputs.forEach(input => {
            input.setAttribute('readonly', true);
            input.classList.remove('editing');
        });
        
        editBtns.forEach(btn => {
            btn.classList.remove('editing');
            const editText = btn.querySelector('.edit-text');
            if (editText) {
                editText.textContent = 'Edit';
            }
        });
        
        // Hide save button
        const saveBtnContainer = document.getElementById('saveBtnContainer');
        if (saveBtnContainer) {
            saveBtnContainer.style.display = 'none';
        }
        
        // Show success notification
        showNotification('Profile updated successfully!', 'success');
        
        // Close modal after a delay
        setTimeout(() => {
            closeProfileSettingsModal();
        }, 1500);
        
    } catch (error) {
        console.error('Error saving profile data:', error);
        showNotification('Error saving profile data', 'error');
    }
}

function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

function showNotification(message, type = 'info') {
    // Remove existing notifications
    const existingNotifications = document.querySelectorAll('.notification');
    existingNotifications.forEach(notification => {
        notification.remove();
    });
    
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
            <span>${message}</span>
        </div>
    `;
    
    // Add to body
    document.body.appendChild(notification);
    
    // Show with animation
    setTimeout(() => {
        notification.classList.add('show');
    }, 10);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// Function to open profile picture viewer
function openProfileViewer(imageSrc) {
    const viewerModal = document.getElementById('profileViewerModal');
    const viewerContent = viewerModal.querySelector('.profile-viewer-content');
    const fullPicture = document.getElementById('fullProfilePicture');
    
    if (!viewerModal || !viewerContent || !fullPicture) return;
    
    // Set the image source
    fullPicture.src = imageSrc;
    
    // Reset animation classes
    viewerModal.classList.remove('fade-out');
    viewerContent.classList.remove('scale-out');
    
    // Show modal
    viewerModal.style.display = 'block';
    
    // Force reflow
    void viewerModal.offsetWidth;
    
    // Add animation classes
    viewerModal.classList.add('fade-in');
    viewerContent.classList.add('scale-in');
    
    // Prevent body scroll
    document.body.style.overflow = 'hidden';
}

// Function to close profile picture viewer
function closeProfileViewer() {
    const viewerModal = document.getElementById('profileViewerModal');
    const viewerContent = viewerModal.querySelector('.profile-viewer-content');
    
    if (!viewerModal || !viewerContent) return;
    
    viewerModal.classList.remove('fade-in');
    viewerContent.classList.remove('scale-in');
    viewerModal.classList.add('fade-out');
    viewerContent.classList.add('scale-out');
    
    setTimeout(() => {
        if (viewerModal.classList.contains('fade-out')) {
            viewerModal.style.display = 'none';
            document.body.style.overflow = '';
        }
    }, 300);
}

// Setup profile viewer modal
function setupProfileViewer() {
    const viewerModal = document.getElementById('profileViewerModal');
    const viewerContent = viewerModal.querySelector('.profile-viewer-content');
    const closeBtn = document.getElementById('profileViewerCloseBtn');
    
    if (!viewerModal || !viewerContent || !closeBtn) return;
    
    // Close button event
    closeBtn.addEventListener('click', closeProfileViewer);
    
    // Close when clicking outside
    viewerModal.addEventListener('click', function(e) {
        if (e.target === viewerModal) {
            closeProfileViewer();
        }
    });
    
    // Close with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && viewerModal.style.display === 'block') {
            closeProfileViewer();
        }
    });
}

// IMMEDIATE BADGE DISPLAY FUNCTION
function ensureBadgeDisplay() {
    const userNameElement = document.getElementById('userName');
    if (!userNameElement) {
        // Try again in a bit if element doesn't exist yet
        setTimeout(ensureBadgeDisplay, 50);
        return;
    }
    
    // Check if badge exists
    let badge = userNameElement.querySelector('.verified-badge');
    
    // Remove existing badge to ensure fresh state
    if (badge) {
        badge.remove();
    }
    
    // Create new badge
    badge = document.createElement('img');
    badge.className = 'verified-badge';
    badge.src = 'https://img.icons8.com/fluency/96/instagram-verification-badge.png';
    badge.alt = 'Verified';
    
    // Set inline styles for immediate display
    badge.style.cssText = `
    width: 40px !important;
    height: 40px !important;
    margin-left: 8px !important;
    vertical-align: middle !important;
    display: inline-block !important;
    opacity: 1 !important;
    visibility: visible !important;
    position: relative !important;
    top: 0px !important;
    `;
    
    // Add to DOM immediately
    userNameElement.appendChild(badge);
    
    // Force immediate display
    setTimeout(() => {
        badge.style.display = 'inline-block';
        badge.style.opacity = '1';
        badge.style.visibility = 'visible';
        void badge.offsetWidth; // Trigger reflow
    }, 0);
}

// Setup modal search functionality
function setupModalSearch() {
    const searchBox = document.getElementById('modalSearchBox');
    const clearBtn = document.getElementById('modalClearSearch');
    const modalContainer = document.getElementById('modalRoutineContainer');
    
    if (!searchBox || !modalContainer) return;
    
    searchBox.addEventListener('input', function(e) {
        const searchTerm = e.target.value.trim().toLowerCase();
        
        // Show/hide clear button
        if (clearBtn) {
            clearBtn.style.display = searchTerm ? 'flex' : 'none';
        }
        
        // Search through routine cards
        const cards = modalContainer.querySelectorAll('.routine-day-card');
        
        cards.forEach(card => {
            const subject = card.querySelector('.class-subject')?.textContent?.toLowerCase() || '';
            const topic = card.querySelector('.class-topic')?.textContent?.toLowerCase() || '';
            
            if (searchTerm === '' || subject.includes(searchTerm) || topic.includes(searchTerm)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });
    
    // Clear search
    if (clearBtn) {
        clearBtn.addEventListener('click', function() {
            searchBox.value = '';
            searchBox.focus();
            
            const cards = modalContainer.querySelectorAll('.routine-day-card');
            cards.forEach(card => {
                card.style.display = 'block';
            });
            
            clearBtn.style.display = 'none';
        });
    }
    
    // Handle escape key
    searchBox.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            searchBox.value = '';
            const cards = modalContainer.querySelectorAll('.routine-day-card');
            cards.forEach(card => {
                card.style.display = 'block';
            });
            if (clearBtn) clearBtn.style.display = 'none';
        }
    });
}

// Function to auto-scroll to today's lecture in expanded modal
function scrollToTodayInModal() {
    const modalContainer = document.getElementById('modalRoutineContainer');
    if (!modalContainer) return;
    
    const today = new Date();
    const todayStr = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getFullYear()}`;
    
    // Find today's card
    const cards = modalContainer.querySelectorAll('.routine-day-card');
    cards.forEach((card, index) => {
        const cardDateElement = card.querySelector('.routine-card-date');
        if (cardDateElement && cardDateElement.textContent.includes(todayStr)) {
            // Scroll to this card
            card.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
            
            // Add highlight effect
            card.style.animation = 'highlightPulse 2s ease';
            setTimeout(() => {
                card.style.animation = '';
            }, 2000);
        }
    });
}

// Image Modal Functionality
function setupImageModal() {
    const noticeImage = document.getElementById('noticeImage');
    const imageModal = document.getElementById('imageModal');
    
    if (!noticeImage || !imageModal) {
        console.warn('Image modal elements not found');
        return;
    }
    
    const imageModalContent = imageModal.querySelector('.image-modal-content');
    const imageCloseBtn = document.getElementById('imageCloseBtn');
    const modalImage = document.getElementById('modalImage');

    // Open modal when image is clicked
    noticeImage.addEventListener('click', function() {
        openImageModal();
    });

    // Close modal when close button is clicked
    if (imageCloseBtn) {
        imageCloseBtn.addEventListener('click', function() {
            closeImageModal();
        });
    }

    // Close modal when clicking outside the image
    imageModal.addEventListener('click', function(e) {
        if (e.target === imageModal) {
            closeImageModal();
        }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && imageModal.style.display === 'block') {
            closeImageModal();
        }
    });

    function openImageModal() {
        // Reset animation classes
        imageModal.classList.remove('fade-out');
        if (imageModalContent) imageModalContent.classList.remove('scale-out');
        
        // Show modal first
        imageModal.style.display = 'block';
        
        // Force reflow
        void imageModal.offsetWidth;
        
        // Add animation classes
        imageModal.classList.add('fade-in');
        if (imageModalContent) imageModalContent.classList.add('scale-in');
        
        // Prevent body scroll
        document.body.style.overflow = 'hidden';
    }

    function closeImageModal() {
        imageModal.classList.remove('fade-in');
        if (imageModalContent) imageModalContent.classList.remove('scale-in');
        imageModal.classList.add('fade-out');
        if (imageModalContent) imageModalContent.classList.add('scale-out');
        
        // Hide modal after animation completes
        setTimeout(() => {
            if (imageModal.classList.contains('fade-out')) {
                imageModal.style.display = 'none';
                // Restore body scroll
                document.body.style.overflow = '';
            }
        }, 300);
    }
}

// Auto-resize containers based on content
function autoResizeContainers() {
    // Resize routine container
    const routineContainer = document.getElementById('routineCardsContainer');
    if (routineContainer) {
        const scrollerWrapper = routineContainer.querySelector('.routine-cards-scroller');
        const routineCards = scrollerWrapper ? scrollerWrapper.querySelectorAll('.routine-day-card') : routineContainer.querySelectorAll('.routine-day-card');
        
        let routineHeight = 0;
        routineCards.forEach(card => {
            routineHeight = Math.max(routineHeight, card.offsetHeight);
        });
        
        // Set minimum height if no cards
        if (routineHeight === 0) {
            routineHeight = 100;
        }
        
        routineContainer.style.minHeight = routineHeight + 'px';
    }
    
    // Resize instructions container
    const instructionsScroller = document.getElementById('instructionsScroller');
    if (instructionsScroller) {
        const instructionItems = instructionsScroller.querySelectorAll('.instruction-item');
        
        let maxInstructionHeight = 0;
        instructionItems.forEach(item => {
            if (item.offsetHeight > maxInstructionHeight) {
                maxInstructionHeight = item.offsetHeight;
            }
        });
        
        // Set minimum height
        if (maxInstructionHeight === 0) {
            maxInstructionHeight = 100;
        }
        
        instructionsScroller.style.minHeight = maxInstructionHeight + 'px';
        
        // Update instruction items height
        instructionItems.forEach(item => {
            item.style.minHeight = maxInstructionHeight + 'px';
        });
    }
}

// Call this function when content changes
function updateContainerSizes() {
    autoResizeContainers();
}

// New Badge Management Functions
function getStoredContentIds(storageKey) {
    try {
        return JSON.parse(localStorage.getItem(storageKey)) || [];
    } catch (error) {
        console.error('Error reading from localStorage:', error);
        return [];
    }
}

function setStoredContentIds(storageKey, ids) {
    try {
        localStorage.setItem(storageKey, JSON.stringify(ids));
    } catch (error) {
        console.error('Error writing to localStorage:', error);
    }
}

// Check for new content in cache files
async function checkForNewContent() {
    try {
        // Load cache files dynamically
        const cacheFiles = [
            { name: 'classroom', url: 'data/cache1.js' },
            { name: 'materials', url: 'data/cache2.js' },
            { name: 'archives', url: 'data/cache4.js' }
        ];

        for (const cacheFile of cacheFiles) {
            await checkCacheFile(cacheFile.name, cacheFile.url);
        }
    } catch (error) {
        console.error('Error checking for new content:', error);
    }
}

async function checkCacheFile(type, fileUrl) {
    try {
        // Add timestamp to avoid cache
        const response = await fetch(fileUrl + '?t=' + Date.now());
        if (!response.ok) {
            return;
        }
        
        const fileContent = await response.text();
        
        let currentIds = [];
        let storageKey = '';
        
        switch (type) {
            case 'classroom':
                // Extract videoIds from cache1.js
                const videoIdMatches = fileContent.match(/videoId:\s*"([^"]+)"/g);
                if (videoIdMatches) {
                    currentIds = videoIdMatches.map(match => {
                        const matchResult = match.match(/videoId:\s*"([^"]+)"/);
                        return matchResult ? matchResult[1] : null;
                    }).filter(id => id !== null);
                }
                storageKey = 'classroomVideoIds';
                break;
                
            case 'materials':
                // Extract URLs from cache2.js
                const urlMatches = fileContent.match(/url:\s*"([^"]+)"/g);
                if (urlMatches) {
                    currentIds = urlMatches.map(match => {
                        const matchResult = match.match(/url:\s*"([^"]+)"/);
                        return matchResult ? matchResult[1] : null;
                    }).filter(url => url !== null);
                }
                storageKey = 'materialsUrls';
                break;
                
            case 'archives':
                // Extract videoIds from cache4.js
                const archiveVideoMatches = fileContent.match(/videoId:\s*"([^"]+)"/g);
                if (archiveVideoMatches) {
                    currentIds = archiveVideoMatches.map(match => {
                        const matchResult = match.match(/videoId:\s*"([^"]+)"/);
                        return matchResult ? matchResult[1] : null;
                    }).filter(id => id !== null);
                }
                storageKey = 'archivesVideoIds';
                break;
        }
        
        // Get stored IDs
        const storedIds = getStoredContentIds(storageKey);
        
        // Check for new content
        const hasNewContent = currentIds.length > 0 && currentIds.some(id => !storedIds.includes(id));
        
        // Update badge
        updateButtonBadge(type, hasNewContent);
        
    } catch (error) {
        console.error(`Error checking ${type} cache:`, error);
    }
}

function updateButtonBadge(buttonType, hasNewContent) {
    const badgeContainer = document.getElementById(`${buttonType}BadgeContainer`);
    if (!badgeContainer) {
        return;
    }
    
    const existingBadge = badgeContainer.querySelector('.badge');
    
    if (hasNewContent && !existingBadge) {
        const newBadge = document.createElement('span');
        newBadge.className = 'badge';
        newBadge.textContent = 'New';
        badgeContainer.appendChild(newBadge);
    } else if (!hasNewContent && existingBadge) {
        existingBadge.remove();
    }
}

// Mark content as seen when button is clicked
function setupButtonClickHandlers() {
    const classroomBtn = document.getElementById('classroomBtn');
    const materialsBtn = document.getElementById('materialsBtn');
    const archivesBtn = document.getElementById('archivesBtn');
    
    if (classroomBtn) {
        classroomBtn.addEventListener('click', function() {
            markContentAsSeen('classroom');
        });
    }
    
    if (materialsBtn) {
        materialsBtn.addEventListener('click', function() {
            markContentAsSeen('materials');
        });
    }
    
    if (archivesBtn) {
        archivesBtn.addEventListener('click', function() {
            markContentAsSeen('archives');
        });
    }
}

async function markContentAsSeen(buttonType) {
    let fileUrl = '';
    let storageKey = '';
    
    switch (buttonType) {
        case 'classroom':
            fileUrl = 'data/cache1.js';
            storageKey = 'classroomVideoIds';
            break;
        case 'materials':
            fileUrl = 'data/cache2.js';
            storageKey = 'materialsUrls';
            break;
        case 'archives':
            fileUrl = 'data/cache4.js';
            storageKey = 'archivesVideoIds';
            break;
    }
    
    try {
        // Add timestamp to avoid cache
        const response = await fetch(fileUrl + '?t=' + Date.now());
        if (!response.ok) {
            return;
        }
        
        const fileContent = await response.text();
        
        let currentIds = [];
        
        if (buttonType === 'materials') {
            // Extract URLs for materials
            const urlMatches = fileContent.match(/url:\s*"([^"]+)"/g);
            if (urlMatches) {
                currentIds = urlMatches.map(match => {
                    const matchResult = match.match(/url:\s*"([^"]+)"/);
                    return matchResult ? matchResult[1] : null;
                }).filter(url => url !== null);
            }
        } else {
            // Extract videoIds for classroom and archives
            const videoMatches = fileContent.match(/videoId:\s*"([^"]+)"/g);
            if (videoMatches) {
                currentIds = videoMatches.map(match => {
                    const matchResult = match.match(/videoId:\s*"([^"]+)"/);
                    return matchResult ? matchResult[1] : null;
                }).filter(id => id !== null);
            }
        }
        
        // Save current IDs to localStorage
        setStoredContentIds(storageKey, currentIds);
        
        // Remove badge
        updateButtonBadge(buttonType, false);
        
    } catch (error) {
        console.error(`Error marking ${buttonType} content as seen:`, error);
    }
}

// Check for new content periodically
function startContentChecking() {
    // Check immediately after a short delay to ensure DOM is ready
    setTimeout(() => {
        checkForNewContent();
    }, 2000);
    
    // Check every 5 minutes
    setInterval(() => {
        checkForNewContent();
    }, 5 * 60 * 1000);
}

// Profile picture functionality with cropping
let cropper = null;
let originalImageData = null;

function setupProfilePicture() {
    const profileIcon = document.getElementById('profileIcon');
    const profileModal = document.getElementById('profileModal');
    const croppingModal = document.getElementById('croppingModal');
    
    if (!profileIcon || !profileModal || !croppingModal) {
        console.warn('Profile picture elements not found');
        return;
    }
    
    const profileModalContent = profileModal.querySelector('.profile-modal-content');
    const croppingModalContent = croppingModal.querySelector('.cropping-modal-content');
    const choosePhotoBtn = document.getElementById('choosePhotoBtn');
    const removePhotoBtn = document.getElementById('removePhotoBtn');
    const cancelProfileBtn = document.getElementById('cancelProfileBtn');
    const profileUploadInput = document.getElementById('profileUploadInput');
    const profilePreview = document.getElementById('profilePreview');
    
    // Cropping modal elements
    const cancelCropBtn = document.getElementById('cancelCropBtn');
    const applyCropBtn = document.getElementById('applyCropBtn');
    const zoomInBtn = document.getElementById('zoomInBtn');
    const zoomOutBtn = document.getElementById('zoomOutBtn');
    const zoomSlider = document.getElementById('zoomSlider');
    const aspectBtns = document.querySelectorAll('.aspect-btn');
    const cropperImage = document.getElementById('cropperImage');
    
    // Confirmation modal elements
    const confirmationModal = document.getElementById('confirmationModal');
    const confirmationModalContent = confirmationModal ? confirmationModal.querySelector('.confirmation-modal-content') : null;
    const cancelRemoveBtn = document.getElementById('cancelRemoveBtn');
    const proceedRemoveBtn = document.getElementById('proceedRemoveBtn');

    // Open modal when profile icon is clicked
    profileIcon.addEventListener('click', function(e) {
        e.stopPropagation();
        openProfileModal();
    });

    // Choose photo button
    if (choosePhotoBtn) {
        choosePhotoBtn.addEventListener('click', function() {
            if (profileUploadInput) profileUploadInput.click();
        });
    }

    // Handle file selection
    if (profileUploadInput) {
        profileUploadInput.addEventListener('change', function(e) {
            if (e.target.files && e.target.files[0]) {
                const file = e.target.files[0];
                
                // Validate file type
                if (!file.type.match('image.*')) {
                    showNotification('Please select a valid image file.', 'error');
                    return;
                }
                
                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('Please select an image smaller than 5MB.', 'error');
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    // Store original image data
                    originalImageData = e.target.result;
                    
                    // Load image into cropper
                    cropperImage.src = e.target.result;
                    
                    // Close profile modal
                    closeProfileModal();
                    
                    // Open cropping modal after a short delay
                    setTimeout(() => {
                        openModal(croppingModal, croppingModalContent);
                        initCropper();
                    }, 300);
                };
                
                reader.readAsDataURL(file);
            }
        });
    }

    // Initialize Cropper.js
    function initCropper() {
        // Destroy existing cropper
        if (cropper) {
            cropper.destroy();
            cropper = null;
        }
        
        // Initialize cropper with circular crop
        cropper = new Cropper(cropperImage, {
            aspectRatio: 1,
            viewMode: 1,
            guides: true,
            center: true,
            highlight: false,
            background: false,
            autoCrop: true,
            autoCropArea: 1,
            responsive: true,
            cropBoxMovable: true,
            cropBoxResizable: true,
            toggleDragModeOnDblclick: false,
            ready: function() {
                // Set initial zoom
                if (zoomSlider) zoomSlider.value = 1;
            }
        });
    }

    // Zoom controls
    if (zoomInBtn) {
        zoomInBtn.addEventListener('click', function() {
            if (cropper) {
                cropper.zoom(0.1);
                updateZoomSlider();
            }
        });
    }

    if (zoomOutBtn) {
        zoomOutBtn.addEventListener('click', function() {
            if (cropper) {
                cropper.zoom(-0.1);
                updateZoomSlider();
            }
        });
    }

    if (zoomSlider) {
        zoomSlider.addEventListener('input', function() {
            if (cropper) {
                cropper.zoomTo(parseFloat(this.value));
            }
        });
    }

    // Aspect ratio controls
    aspectBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            // Update active button
            aspectBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            if (cropper) {
                const aspect = this.dataset.aspect;
                if (aspect === 'free') {
                    cropper.setAspectRatio(NaN);
                } else {
                    cropper.setAspectRatio(parseFloat(aspect));
                }
            }
        });
    });

    // Apply crop button
    if (applyCropBtn) {
        applyCropBtn.addEventListener('click', function() {
            if (cropper) {
                // Get cropped canvas
                const canvas = cropper.getCroppedCanvas({
                    width: 300,
                    height: 300,
                    imageSmoothingEnabled: true,
                    imageSmoothingQuality: 'high'
                });
                
                // Convert to data URL
                const croppedImage = canvas.toDataURL('image/jpeg', 0.9);
                
                // Update preview with clickable image
                if (profilePreview) {
                    profilePreview.innerHTML = `
                        <img src="${croppedImage}" 
                             class="profile-preview-img" 
                             alt="Profile Preview"
                             style="cursor: pointer;"
                             onclick="openProfileViewer('${croppedImage}')">
                    `;
                }
                
                // Save to localStorage and update profile
                saveProfilePicture(croppedImage);
                updateProfilePicture(croppedImage);
                
                // Update button text and show remove button
                if (choosePhotoBtn) choosePhotoBtn.textContent = 'Change Photo';
                if (removePhotoBtn) {
                    removePhotoBtn.style.display = 'block';
                    removePhotoBtn.classList.add('remove');
                }
                
                // Show success notification
                showNotification('Profile picture updated successfully!', 'success');
                
                // Close cropping modal
                closeModal(croppingModal, croppingModalContent);
            }
        });
    }

    // Cancel crop button
    if (cancelCropBtn) {
        cancelCropBtn.addEventListener('click', function() {
            closeModal(croppingModal, croppingModalContent);
            
            // Reopen profile modal after delay
            setTimeout(() => {
                openProfileModal(); // Changed from openModal to openProfileModal
            }, 300);
        });
    }

    // Update zoom slider based on cropper zoom
    function updateZoomSlider() {
        if (cropper && zoomSlider) {
            const data = cropper.getData();
            zoomSlider.value = data.scaleX || 1;
        }
    }

    // Remove photo button - show confirmation modal
    if (removePhotoBtn) {
        removePhotoBtn.addEventListener('click', function() {
            if (!confirmationModal) return;
            openModal(confirmationModal, confirmationModalContent);
        });
    }

    // Proceed with removal
    if (proceedRemoveBtn) {
        proceedRemoveBtn.addEventListener('click', function() {
            // Remove profile picture
            localStorage.removeItem('userProfilePicture');
            updateProfilePicture(null);
            
            // Update button text and hide remove button
            if (choosePhotoBtn) choosePhotoBtn.textContent = 'Choose Photo';
            if (removePhotoBtn) {
                removePhotoBtn.style.display = 'none';
                removePhotoBtn.classList.remove('remove');
            }
            
            // Clear session storage
            sessionStorage.removeItem('profilePicture');
            sessionStorage.removeItem('profilePictureURL');
            
            // Show notification
            showNotification('Profile picture removed successfully!', 'success');
            
            // Close both modals
            closeModal(confirmationModal, confirmationModalContent);
            closeProfileModal();
        });
    }

    // Cancel removal
    if (cancelRemoveBtn) {
        cancelRemoveBtn.addEventListener('click', function() {
            closeModal(confirmationModal, confirmationModalContent);
        });
    }

    // Cancel button (profile modal)
    if (cancelProfileBtn) {
        cancelProfileBtn.addEventListener('click', function() {
            closeProfileModal();
        });
    }

    // Modal helper functions
    function openModal(modal, content) {
        if (!modal || !content) return;
        
        modal.classList.remove('fade-out');
        content.classList.remove('scale-out');
        modal.style.display = 'block';
        
        void modal.offsetWidth;
        
        modal.classList.add('fade-in');
        content.classList.add('scale-in');
        
        // Prevent body scroll
        document.body.style.overflow = 'hidden';
    }
    
    function closeModal(modal, content) {
        if (!modal || !content) return;
        
        modal.classList.remove('fade-in');
        content.classList.remove('scale-in');
        modal.classList.add('fade-out');
        content.classList.add('scale-out');
        
        setTimeout(() => {
            if (modal.classList.contains('fade-out')) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
                
                // Clean up cropper if closing cropping modal
                if (modal === croppingModal && cropper) {
                    cropper.destroy();
                    cropper = null;
                }
            }
        }, 300);
    }

    // Close modals when clicking outside
    window.addEventListener('click', function(e) {
        if (e.target === profileModal) {
            closeProfileModal();
        }
        if (e.target === croppingModal) {
            closeModal(croppingModal, croppingModalContent);
        }
        if (confirmationModal && e.target === confirmationModal) {
            closeModal(confirmationModal, confirmationModalContent);
        }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            if (profileModal.style.display === 'block') {
                closeProfileModal();
            } else if (croppingModal.style.display === 'block') {
                closeModal(croppingModal, croppingModalContent);
            } else if (confirmationModal && confirmationModal.style.display === 'block') {
                closeModal(confirmationModal, confirmationModalContent);
            }
        }
    });
}

// Load profile picture from localStorage IMMEDIATELY
function loadProfilePicture() {
    try {
        // Try to get from localStorage first
        let imageData = localStorage.getItem('userProfilePicture');
        
        // If not in localStorage, try sessionStorage
        if (!imageData) {
            imageData = sessionStorage.getItem('profilePicture');
        }
        
        console.log('Loading profile picture:', imageData ? 'Found' : 'Not found');
        
        if (imageData) {
            // Verify it's a valid data URL
            if (imageData.startsWith('data:image/')) {
                // Update main profile picture display
                updateProfilePicture(imageData);
                
                // Cache in sessionStorage for faster loading next time
                sessionStorage.setItem('profilePicture', imageData);
                
                // Also update settings modal preview if it exists
                updateProfileSettingsPreview();
            } else {
                console.warn('Invalid image data format');
                // Clear invalid data
                localStorage.removeItem('userProfilePicture');
                sessionStorage.removeItem('profilePicture');
                sessionStorage.removeItem('profilePictureURL');
            }
        } else {
            // No picture found, ensure placeholder is shown
            updateProfilePicture(null);
            updateProfileSettingsPreview();
        }
    } catch (error) {
        console.error('Error loading profile picture:', error);
        // Fallback to showing placeholder
        updateProfilePicture(null);
        updateProfileSettingsPreview();
    }
}

function dataURItoBlob(dataURI) {
    const byteString = atob(dataURI.split(',')[1]);
    const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
    const ab = new ArrayBuffer(byteString.length);
    const ia = new Uint8Array(ab);
    for (let i = 0; i < byteString.length; i++) {
        ia[i] = byteString.charCodeAt(i);
    }
    return new Blob([ab], {type: mimeString});
}


// Update profile picture display IMMEDIATELY
function updateProfilePicture(imageData) {
    const profileIcon = document.getElementById('profileIcon');
    if (!profileIcon) return;
    
    const profilePlaceholder = document.getElementById('profilePlaceholder');
    
    if (imageData) {
        // Remove placeholder and add image
        if (profilePlaceholder) {
            profilePlaceholder.style.display = 'none';
        }
        
        // Check if image already exists
        let existingImage = profileIcon.querySelector('.profile-picture');
        if (existingImage) {
            existingImage.src = imageData;
        } else {
            const profileImage = document.createElement('img');
            profileImage.className = 'profile-picture';
            profileImage.src = imageData;
            profileImage.alt = 'Profile Picture';
            
            // Ensure image is displayed as circle
            profileImage.style.cssText = `
                width: 100%;
                height: 100%;
                object-fit: cover;
                border-radius: 50%;
                cursor: pointer;
            `;
            
            // Make image clickable to open viewer
            profileImage.addEventListener('click', function(e) {
                e.stopPropagation();
                openProfileViewer(imageData);
            });
            
            profileIcon.insertBefore(profileImage, profileIcon.firstChild);
        }
    } else {
        // Remove image and show placeholder
        const existingImage = profileIcon.querySelector('.profile-picture');
        if (existingImage) {
            existingImage.remove();
        }
        if (profilePlaceholder) {
            profilePlaceholder.style.display = 'flex';
        }
    }
    
    // Update the settings modal preview
    updateProfileSettingsPreview();
}

// Access verification script
(function() {
    // Check if all required access fields exist and have values
    const requiredFields = [
        'accessGranted',
        'accessKey', 
        'accessTime',
        'userGmail',
        'userName',
        'verificationCode'
    ];
    
    let hasValidAccess = true;
    
    // Check each required field
    for (const field of requiredFields) {
        const value = localStorage.getItem(field);
        
        // If any field is missing, empty, or invalid
        if (!value || value.trim() === '' || value === 'null' || value === 'undefined') {
            hasValidAccess = false;
            break;
        }
    }
    
    // Special check for accessGranted must be exactly "true"
    if (localStorage.getItem('accessGranted') !== 'true') {
        hasValidAccess = false;
    }
    
    // Redirect to login if access is invalid
    if (!hasValidAccess) {
        window.location.href = 'log.html';
    }
})();

// Update time and date
function updateTimeDate() {
    const now = new Date();
    
    // Format time (12-hour format)
    let hours = now.getHours();
    const minutes = now.getMinutes().toString().padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; // 0 should be 12
    const timeString = `${hours}:${minutes} ${ampm}`;
    
    // Format date with weekday
    const weekdayOptions = { weekday: 'long' };
    const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
    
    const weekdayString = now.toLocaleDateString('en-US', weekdayOptions);
    const dateString = now.toLocaleDateString('en-US', dateOptions);
    
    const currentTimeEl = document.getElementById('currentTime');
    const currentDateEl = document.getElementById('currentDate');
    
    if (currentTimeEl) {
        const timeSpan = currentTimeEl.querySelector('span');
        if (timeSpan) {
            timeSpan.textContent = timeString;
        } else {
            currentTimeEl.innerHTML = `<i class="fas fa-clock"></i><span>${timeString}</span>`;
        }
    }
    
    if (currentDateEl) {
        const dateSpan = currentDateEl.querySelector('span');
        if (dateSpan) {
            dateSpan.textContent = `${weekdayString}, ${dateString}`;
        } else {
            currentDateEl.innerHTML = `<i class="far fa-calendar-alt"></i><span>${weekdayString}, ${dateString}</span>`;
        }
    }
}

// Display user info
function displayUserInfo() {
    const userName = localStorage.getItem('userName');
    const userEmail = localStorage.getItem('userGmail');
    
    const userNameEl = document.getElementById('userName');
    
    if (userName && userNameEl) {
        const userNameSpan = userNameEl.querySelector('span');
        if (userNameSpan) {
            userNameSpan.textContent = userName;
        } else {
            userNameEl.innerHTML = `<span>${userName}</span>`;
        }
    }
}

// PCMB Timer Functions
// Check if current time is within 24h window (8:00 PM to next day 8:00 PM)
function isWithin24hWindow() {
    const now = new Date();
    const today8_00 = new Date();
    today8_00.setHours(20, 0, 0, 0); // 8:00 PM
    
    // If current time is before 8:00 PM, use yesterday's 8:00 PM as start
    const startTime = now < today8_00 ? 
        new Date(today8_00.getTime() - 24 * 60 * 60 * 1000) : 
        today8_00;
        
    const endTime = new Date(startTime.getTime() + 24 * 60 * 60 * 1000);
    
    return now >= startTime && now < endTime;
}

// Update PCMB timer
function updatePCMBTimer() {
    const now = new Date();
    const today8_00 = new Date();
    today8_00.setHours(20, 0, 0, 0); // 8:00 PM today
    
    let nextReset;
    
    if (now < today8_00) {
        // Next reset is today at 8:00 PM
        nextReset = today8_00;
    } else {
        // Next reset is tomorrow at 8:00 PM
        nextReset = new Date(today8_00.getTime() + 24 * 60 * 60 * 1000);
    }
    
    const timeLeft = nextReset - now;
    
    const pcmbTimerEl = document.getElementById('pcmbTimer');
    if (!pcmbTimerEl) return;
    
    if (timeLeft <= 0) {
        pcmbTimerEl.textContent = "Uploaded!";
        return;
    }
    
    const hours = Math.floor(timeLeft / (1000 * 60 * 60));
    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
    
    pcmbTimerEl.innerHTML = `<span class="limited-time-icon"><i class="fas fa-clock"></i></span> Friday`;
}

// Populate routine tables for both views
function populateRoutineTables() {
    // Check if routineData exists
    if (typeof routineData === 'undefined') {
        return;
    }
    
    const today = new Date();
    
    // Clear existing content
    const routineContainer = document.getElementById('routineCardsContainer');
    const modalRoutineContainer = document.getElementById('modalRoutineContainer');
    
    if (routineContainer) routineContainer.innerHTML = '';
    if (modalRoutineContainer) modalRoutineContainer.innerHTML = '';
    
    // Group classes by date
    const classesByDate = {};
    routineData.forEach(item => {
        if (!classesByDate[item.date]) {
            classesByDate[item.date] = [];
        }
        classesByDate[item.date].push(item);
    });
    
    // Create scroller wrapper for main view
    if (routineContainer) {
        let scrollerWrapper = routineContainer.querySelector('.routine-cards-scroller');
        if (!scrollerWrapper) {
            scrollerWrapper = document.createElement('div');
            scrollerWrapper.className = 'routine-cards-scroller';
            routineContainer.appendChild(scrollerWrapper);
        }
        
        // Populate main view (upcoming Friday only)
        const currentDay = today.getDay(); // 0 = Sunday, 5 = Friday

        // Calculate days until next Friday
        let daysUntilFriday;
        if (currentDay < 5) {
            daysUntilFriday = 5 - currentDay; // Friday is ahead this week
        } else if (currentDay === 5) {
            // Today is Friday - check if there are classes today
            daysUntilFriday = 0;
        } else {
            // Today is Saturday, so next Friday is 6 days away
            daysUntilFriday = 6; // (5 + 7) - currentDay
        }

        const fridayDate = new Date(today);
        fridayDate.setDate(today.getDate() + daysUntilFriday);

        // Format date as DD/MM/YYYY to match routineData
        const fridayDateStr = `${fridayDate.getDate().toString().padStart(2, '0')}/${(fridayDate.getMonth() + 1).toString().padStart(2, '0')}/${fridayDate.getFullYear()}`;

        const fridayClasses = routineData.filter(item => item.date === fridayDateStr);

        const isCompleted = isClassCompleted(fridayDate);
        const isToday = daysUntilFriday === 0;
        const card = createRoutineCard(fridayDateStr, fridayClasses, isCompleted, isToday, false);
        scrollerWrapper.appendChild(card);

        // Update the routine navigation to reflect only Friday
        updateRoutineNavigationForFriday(daysUntilFriday);
    }
    
    // Populate modal view (all dates)
    if (modalRoutineContainer) {
        Object.keys(classesByDate).sort((a, b) => {
            // Parse dates in DD/MM/YYYY format for sorting
            const [dayA, monthA, yearA] = a.split('/');
            const [dayB, monthB, yearB] = b.split('/');
            return new Date(yearA, monthA - 1, dayA) - new Date(yearB, monthB - 1, dayB);
        }).forEach(date => {
            // Parse date in DD/MM/YYYY format
            const [day, month, year] = date.split('/');
            const itemDate = new Date(year, month - 1, day);
            const isCompleted = isClassCompleted(itemDate);
            const isToday = itemDate.toDateString() === today.toDateString();
            
            const card = createRoutineCard(date, classesByDate[date], isCompleted, isToday, true);
            modalRoutineContainer.appendChild(card);
        });
    }
}

// Update the routine navigation to reflect only Friday
function updateRoutineNavigationForFriday(daysUntilFriday) {
    const dayTitle = document.getElementById('dayDisplay');
    const dots = document.querySelectorAll('.routine-nav-dot');
    
    if (dayTitle) {
        if (daysUntilFriday === 0) {
            dayTitle.textContent = "Today";
        } else if (daysUntilFriday === 1) {
            dayTitle.textContent = "Tomorrow";
        } else {
            const today = new Date();
            const fridayDate = new Date(today);
            fridayDate.setDate(today.getDate() + daysUntilFriday);
            
            const weekdayOptions = { weekday: 'long' };
            const weekday = fridayDate.toLocaleDateString('en-US', weekdayOptions);
            
            if (daysUntilFriday <= 6) {
                dayTitle.textContent = `${weekday}`;
            } else {
                const dateOptions = { month: 'short', day: 'numeric' };
                const dateStr = fridayDate.toLocaleDateString('en-US', dateOptions);
                dayTitle.textContent = `${weekday}, ${dateStr}`;
            }
        }
    }
    
    // Hide dots since we only show Friday
    if (dots && dots.length > 0) {
        dots.forEach(dot => dot.style.display = 'none');
    }
}

// Create routine card for both views
function createRoutineCard(date, classes, isCompleted, isToday, isExpandedView) {
    const card = document.createElement('div');
    card.className = 'routine-day-card';
    
    // Parse the date in DD/MM/YYYY format and add weekday
    const [day, month, year] = date.split('/');
    const itemDate = new Date(year, month - 1, day);
    const weekdayOptions = { weekday: 'long' };
    const weekday = itemDate.toLocaleDateString('en-US', weekdayOptions);
    const displayDate = `${weekday}, ${date}`;
    
    // Define subject icons and colors
    const subjectStyles = {
        'Physics': { icon: 'fas fa-atom', color: '#ff6b6b' },
        'Chemistry': { icon: 'fas fa-flask', color: '#4ecdc4' },
        'Mathematics': { icon: 'fas fa-square-root-alt', color: '#45b7d1' },
        'Biology': { icon: 'fas fa-dna', color: '#96ceb4' },
        'English': { icon: 'fas fa-book', color: '#feca57' },
        'Bangla': { icon: 'fas fa-language', color: '#ff9ff3' },
        'ICT': { icon: 'fas fa-laptop-code', color: '#54a0ff' },
        'Mentorship Session': { icon: 'fas fa-chalkboard-teacher', color: '#9b59b6' }
    };
    
    // Create class cards
    let classCardsContent = '';
    if (classes.length > 0) {
        classCardsContent = classes.map(cls => {
            const subjectStyle = subjectStyles[cls.subject] || { icon: 'fas fa-book', color: '#ffffff' };
            return `
                <div class="class-card">
                    <div class="class-header">
                        <i class="subject-icon ${subjectStyle.icon}" style="color: ${subjectStyle.color};"></i>
                        <div class="class-info">
                            <div class="class-topic">${cls.topic}</div>
                            <div class="class-subject">${cls.subject}</div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    } else {
        classCardsContent = `
            <div class="no-classes-message">
                <i class="fas fa-calendar-times"></i>
                <p>Currently there are no classes available!</p>
            </div>
        `;
    }
    
    card.innerHTML = `
        <div class="routine-card-header">
            <div class="routine-card-date">
                <i class="far fa-calendar"></i>
                ${displayDate}
            </div>
            ${isExpandedView ? `<div class="routine-card-status ${isCompleted ? 'status-completed' : 'status-incomplete'}">${isCompleted ? '‚úî' : '‚úñ'}</div>` : ''}
        </div>
        <div class="routine-classes-container">
            ${classCardsContent}
        </div>
    `;
    
    return card;
}

// Check if class is completed (after 8:00 PM on scheduled date)
function isClassCompleted(classDate) {
    const now = new Date();
    const completionTime = new Date(classDate);
    completionTime.setHours(20, 0, 0, 0); // 8:00 PM
    
    return now >= completionTime;
}

// Modal functionality with fade effects
function setupModal() {
    const modal = document.getElementById('routineModal');
    if (!modal) {
        return;
    }
    
    const modalContent = modal.querySelector('.modal-content');
    const expandBtn = document.getElementById('expandRoutineBtn');
    const closeBtn = document.getElementById('closeModalBtn');
    
    if (expandBtn) {
        expandBtn.addEventListener('click', function() {
            modal.classList.remove('fade-out');
            if (modalContent) modalContent.classList.remove('scale-out');
            modal.classList.add('fade-in');
            if (modalContent) modalContent.classList.add('scale-in');
            modal.style.display = 'block';
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
            
            // Auto-scroll to today after modal opens
            setTimeout(scrollToTodayInModal, 500);
        });
    }
    
    if (closeBtn) {
        closeBtn.addEventListener('click', function() {
            modal.classList.remove('fade-in');
            if (modalContent) modalContent.classList.remove('scale-in');
            modal.classList.add('fade-out');
            if (modalContent) modalContent.classList.add('scale-out');
            
            // Restore body scroll
            setTimeout(() => {
                document.body.style.overflow = '';
            }, 300);
            
            // Hide modal after animation completes
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        });
    }
    
    window.addEventListener('click', function(event) {
        if (event.target === modal) {
            modal.classList.remove('fade-in');
            if (modalContent) modalContent.classList.remove('scale-in');
            modal.classList.add('fade-out');
            if (modalContent) modalContent.classList.add('scale-out');
            
            // Restore body scroll
            setTimeout(() => {
                document.body.style.overflow = '';
            }, 300);
            
            // Hide modal after animation completes
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }
    });
}

// Add fade effect to buttons
function addButtonEffects() {
    const buttons = document.querySelectorAll('.cube-button, .expand-btn');
    
    buttons.forEach(button => {
        button.addEventListener('click', function(e) {
            // Create ripple effect
            const ripple = document.createElement('span');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;
            
            ripple.style.cssText = `
                position: absolute;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.5);
                transform: scale(0);
                animation: ripple 0.6s linear;
                width: ${size}px;
                height: ${size}px;
                top: ${y}px;
                left: ${x}px;
            `;
            
            this.appendChild(ripple);
            
            // Remove ripple after animation
            setTimeout(() => {
                ripple.remove();
            }, 600);
        });
    });
}

// Instructions Scroller Animation Functionality
function setupInstructionsScrolling() {
    const scroller = document.getElementById('instructionsScroller');
    const itemsWrapper = document.getElementById('instructionItemsWrapper');
    const scrollLeftBtn = document.getElementById('scrollLeftBtn');
    const scrollRightBtn = document.getElementById('scrollRightBtn');
    const indicator = document.getElementById('instructionsIndicator');
    
    if (!scroller || !itemsWrapper || !scrollLeftBtn || !scrollRightBtn || !indicator) {
        return;
    }
    
    const instructionItems = Array.from(itemsWrapper.querySelectorAll('.instruction-item'));
    
    if (instructionItems.length === 0) {
        return;
    }
    
    let currentIndex = 0;

    // Clear and create indicator dots
    indicator.innerHTML = '';
    instructionItems.forEach((_, index) => {
        const dot = document.createElement('div');
        dot.className = 'indicator-dot';
        if (index === 0) dot.classList.add('active');
        dot.addEventListener('click', () => {
            showInstruction(index);
        });
        indicator.appendChild(dot);
    });
    
    const dots = indicator.querySelectorAll('.indicator-dot');

    // Show specific instruction
    function showInstruction(index) {
        if (index < 0 || index >= instructionItems.length) return;
        
        // Calculate scroll position
        const scrollPosition = -index * 100;
        
        // Apply transform for smooth scrolling
        itemsWrapper.style.transform = `translateX(${scrollPosition}%)`;
        
        // Update dots
        dots.forEach(dot => dot.classList.remove('active'));
        dots[index].classList.add('active');
        
        // Update current index
        currentIndex = index;
        
        // Update button visibility
        updateButtonVisibility();
        
        // Update container sizes
        setTimeout(updateContainerSizes, 50);
    }

    // Update button visibility - HIDE instead of grey out
    function updateButtonVisibility() {
        // Use CSS classes instead of inline styles
        if (currentIndex === 0) {
            scrollLeftBtn.classList.add('hidden');
            scrollLeftBtn.disabled = true;
        } else {
            scrollLeftBtn.classList.remove('hidden');
            scrollLeftBtn.disabled = false;
        }
        
        if (currentIndex === instructionItems.length - 1) {
            scrollRightBtn.classList.add('hidden');
            scrollRightBtn.disabled = true;
        } else {
            scrollRightBtn.classList.remove('hidden');
            scrollRightBtn.disabled = false;
        }
    }
    
    // Event listeners
    scrollLeftBtn.addEventListener('click', () => {
        if (currentIndex > 0) {
            showInstruction(currentIndex - 1);
        }
    });
    
    scrollRightBtn.addEventListener('click', () => {
        if (currentIndex < instructionItems.length - 1) {
            showInstruction(currentIndex + 1);
        }
    });
    
    // Touch swipe support for mobile
    let touchStartX = 0;
    let touchEndX = 0;
    
    scroller.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
    });
    
    scroller.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
    });
    
    function handleSwipe() {
        const swipeThreshold = 50;
        const diff = touchStartX - touchEndX;
        
        if (Math.abs(diff) > swipeThreshold) {
            if (diff > 0 && currentIndex < instructionItems.length - 1) {
                // Swipe left - go to next
                showInstruction(currentIndex + 1);
            } else if (diff < 0 && currentIndex > 0) {
                // Swipe right - go to previous
                showInstruction(currentIndex - 1);
            }
        }
    }

    // Initialize
    showInstruction(0);
    updateButtonVisibility();
    
    // Ensure proper initial layout
    setTimeout(() => {
        updateContainerSizes();
    }, 200);
}

// Routine Scroller Animation Functionality
function setupRoutineScroller() {
    const routineContainer = document.getElementById('routineCardsContainer');
    const prevDayBtn = document.getElementById('prevDayBtn');
    const nextDayBtn = document.getElementById('nextDayBtn');
    const dots = document.querySelectorAll('.routine-nav-dot');
    const dayTitle = document.getElementById('dayDisplay');
    
    if (!routineContainer || !prevDayBtn || !nextDayBtn || !dayTitle) {
        return;
    }
    
    // Since we only show Friday, disable all navigation
    prevDayBtn.style.display = 'none';
    nextDayBtn.style.display = 'none';
    
    // Hide dots
    if (dots && dots.length > 0) {
        dots.forEach(dot => dot.style.display = 'none');
    }
    
    // We don't need scroller functionality for single day
    const scrollerWrapper = routineContainer.querySelector('.routine-cards-scroller');
    if (scrollerWrapper) {
        // Remove transform since we only have one card
        scrollerWrapper.style.transform = 'translateX(0%)';
    }
}

// Initialize everything when page loads
document.addEventListener('DOMContentLoaded', function() {
    try {
        // Load profile picture and badge FIRST
        loadProfilePicture();
        ensureBadgeDisplay();
        
        // Then load everything else
        updateTimeDate();
        displayUserInfo();
        updatePCMBTimer();
        
        // Initialize with proper sequencing
        setTimeout(() => {
            populateRoutineTables();
            
            setTimeout(() => {
                setupRoutineScroller();
                setupModal();
                addButtonEffects();
                setupProfilePicture();
                setupProfileViewer();
                setupImageModal();
                setupInstructionsScrolling();
                setupButtonClickHandlers();
                startContentChecking();
                setupModalSearch();
                setupSettingsDropdown();
                setupProfileSettingsModal();
                
                // ADD THIS LINE: Setup profile picture in settings modal
                setupProfilePictureInSettings();
                
                // Force badge display again to ensure it's visible
                setTimeout(ensureBadgeDisplay, 500);
            }, 200);
        }, 300);
        
        // Update time every minute
        setInterval(updateTimeDate, 1000);
        
        // Update PCMB timer every minute
        setInterval(updatePCMBTimer, 60000);
        
    } catch (error) {
        console.error('Error during initialization:', error);
    }
});

// Add CSS for hidden class and animations
const style = document.createElement('style');
style.textContent = `
    .hidden {
        opacity: 0 !important;
        visibility: hidden !important;
        pointer-events: none !important;
    }
    
    @keyframes ripple {
        to {
            transform: scale(4);
            opacity: 0;
        }
    }
    
    @keyframes highlightPulse {
        0% { box-shadow: 0 0 0 0 rgba(255, 200, 87, 0.7); }
        50% { box-shadow: 0 0 20px 10px rgba(255, 200, 87, 0.3); }
        100% { box-shadow: 0 0 0 0 rgba(255, 200, 87, 0); }
    }
    
    /* New Routine Card Styles */
    .routine-classes-container {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 15px;
    }
    
    .class-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 15px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }
    
    .class-card:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .class-header {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .subject-icon {
        font-size: 28px;
        width: 35px;
        text-align: center;
        flex-shrink: 0;
    }
    
    .class-info {
        flex: 1;
        min-width: 0;
    }
    
    .class-topic {
        font-size: 16px;
        font-weight: 600;
        color: #ffffff;
        margin-bottom: 4px;
        line-height: 1.4;
    }
    
    .class-subject {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.7);
        font-weight: 500;
    }
    
    .no-classes-message {
        text-align: center;
        padding: 30px 20px;
        color: #a0aec0;
    }
    
    .no-classes-message i {
        font-size: 40px;
        margin-bottom: 10px;
        display: block;
        opacity: 0.7;
    }
    
    .no-classes-message p {
        margin: 0;
        font-size: 16px;
    }
    
    /* Status styles */
    .completed {
        color: #48bb78;
    }
    
    .today {
        color: #feca57;
    }
    
    .upcoming {
        color: #ef4444;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .class-card {
            padding: 12px;
        }
        
        .subject-icon {
            font-size: 24px;
            width: 30px;
        }
        
        .class-topic {
            font-size: 15px;
        }
        
        .class-subject {
            font-size: 13px;
        }
    }
    
    @media (max-width: 480px) {
        .class-card {
            padding: 10px;
        }
        
        .subject-icon {
            font-size: 22px;
            width: 28px;
        }
        
        .class-header {
            gap: 12px;
        }
        
        .class-topic {
            font-size: 14px;
        }
        
        .class-subject {
            font-size: 12px;
        }
    }
    
    /* Notification Styles */
    .notification {
        position: fixed;
        top: 100px;
        right: 20px;
        background: rgba(20, 20, 30, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 15px 20px;
        min-width: 300px;
        max-width: 400px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        transform: translateX(120%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 10000;
    }
    
    .notification.show {
        transform: translateX(0);
    }
    
    .notification.success {
        border-left: 4px solid #48bb78;
    }
    
    .notification.error {
        border-left: 4px solid #ef4444;
    }
    
    .notification-content {
        display: flex;
        align-items: center;
        gap: 12px;
        color: white;
        font-weight: 500;
    }
    
    .notification-content i {
        font-size: 18px;
    }
    
    .notification.success .notification-content i {
        color: #48bb78;
    }
    
    .notification.error .notification-content i {
        color: #ef4444;
    }
    
    @media (max-width: 768px) {
        .notification {
            top: 80px;
            right: 10px;
            left: 10px;
            min-width: auto;
            max-width: none;
        }
    }
`;
document.head.appendChild(style);

// Call badge display immediately
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        ensureBadgeDisplay();
        setTimeout(ensureBadgeDisplay, 100);
    });
} else {
    ensureBadgeDisplay();
    setTimeout(ensureBadgeDisplay, 100);
}
</script>
</body>
</html>
