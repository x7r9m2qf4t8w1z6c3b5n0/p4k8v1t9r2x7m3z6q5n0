<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arora AI - Intelligent Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Hind Siliguri', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #0a0a0a;
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(26, 26, 46, 0.5) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(15, 52, 96, 0.4) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(22, 33, 62, 0.3) 0%, transparent 30%);
            z-index: -1;
        }

        /* Professional Header */
        .header {
            background: rgba(15, 15, 20, 0.95);
            color: #ffffff;
            padding: 20px 0;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            animation: slideDown 0.5s ease-out;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            animation: pulse 2s infinite;
        }

        .logo-text {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tagline {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 300;
            margin-top: 2px;
        }

        /* Main Container */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 120px 20px 40px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Chat Container */
        .chat-container {
            background: rgba(20, 20, 30, 0.7);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            flex: 1;
            display: flex;
            flex-direction: column;
            animation: fadeInUp 0.6s ease-out 0.2s both;
            position: relative;
            overflow: hidden;
        }

        /* Welcome Banner */
        .welcome-banner {
            text-align: center;
            padding: 20px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(33, 150, 243, 0.1));
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.8s ease-out;
        }

        .welcome-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 300;
        }

        /* Messages Area */
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px 10px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            scroll-behavior: smooth;
        }

        /* Message Styles */
        .message {
            display: flex;
            gap: 16px;
            animation: fadeInMessage 0.4s ease-out;
            max-width: 80%;
            opacity: 0;
            transform: translateY(10px);
            animation-fill-mode: forwards;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
            animation-name: fadeInMessageRight;
        }

        .message.ai {
            animation-name: fadeInMessageLeft;
        }

        .message-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
            margin-top: 4px;
            transition: transform 0.3s ease;
        }

        .message:hover .message-avatar {
            transform: scale(1.05);
        }

        .user .message-avatar {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.4));
            color: #4CAF50;
            border: 2px solid rgba(76, 175, 80, 0.3);
        }

        .ai .message-avatar {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.2), rgba(33, 150, 243, 0.4));
            color: #2196F3;
            border: 2px solid rgba(33, 150, 243, 0.3);
        }

        .message-content {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 18px 22px;
            max-width: 100%;
            word-wrap: break-word;
            border: 1px solid rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(10px);
            position: relative;
            transition: transform 0.3s ease;
        }

        .message-content:hover {
            transform: translateY(-2px);
        }

        .user .message-content {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(76, 175, 80, 0.08));
            border-color: rgba(76, 175, 80, 0.25);
            border-bottom-right-radius: 6px;
        }

        .ai .message-content {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.15), rgba(33, 150, 243, 0.08));
            border-color: rgba(33, 150, 243, 0.25);
            border-bottom-left-radius: 6px;
        }

        .message-text {
            font-size: 16px;
            line-height: 1.7;
            color: rgba(255, 255, 255, 0.95);
        }

        .ai .message-text {
            animation: textReveal 0.5s ease-out;
        }

        .message-time {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 10px;
            text-align: right;
            font-weight: 300;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 6px;
            margin-bottom: 10px;
            padding: 12px 22px;
            background: rgba(33, 150, 243, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(33, 150, 243, 0.2);
            width: fit-content;
            animation: fadeIn 0.3s ease;
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        /* Input Area */
        .input-container {
            display: flex;
            gap: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 18px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.12);
            transition: all 0.3s ease;
            position: relative;
        }

        .input-container:focus-within {
            border-color: rgba(76, 175, 80, 0.4);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.2);
            transform: translateY(-2px);
        }

        .message-input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            resize: none;
            max-height: 150px;
            min-height: 28px;
            outline: none;
            font-weight: 400;
            padding: 4px 0;
            line-height: 1.6;
        }

        .message-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
            font-weight: 300;
        }

        .send-button {
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            border: none;
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .send-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .send-button:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);
        }

        .send-button:hover::before {
            opacity: 1;
        }

        .send-button:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            opacity: 0.6;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
            font-weight: 300;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Animations */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInMessage {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInMessageLeft {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInMessageRight {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes textReveal {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes typingAnimation {
            0%, 80%, 100% { 
                transform: scale(0.8); 
                opacity: 0.5; 
            }
            40% { 
                transform: scale(1); 
                opacity: 1; 
            }
        }

        @keyframes pulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
            }
            50% { 
                transform: scale(1.05); 
                box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
            }
        }

        /* Scrollbar */
        .messages-area::-webkit-scrollbar {
            width: 8px;
        }

        .messages-area::-webkit-scrollbar-track {
            background: rgba(20, 20, 30, 0.3);
            border-radius: 10px;
            margin: 5px 0;
        }

        .messages-area::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            border-radius: 10px;
        }

        .messages-area::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #66BB6A, #42A5F5);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                max-width: 90%;
                padding: 110px 15px 30px;
            }
            
            .chat-container {
                padding: 25px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 15px 0;
            }
            
            .header-content {
                padding: 0 15px;
            }
            
            .logo-text {
                font-size: 24px;
            }
            
            .logo-icon {
                width: 36px;
                height: 36px;
                font-size: 18px;
            }
            
            .container {
                padding: 100px 12px 25px;
            }
            
            .chat-container {
                padding: 20px;
                border-radius: 20px;
            }
            
            .welcome-title {
                font-size: 20px;
            }
            
            .message {
                max-width: 90%;
                gap: 12px;
            }
            
            .message-avatar {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .message-content {
                padding: 16px 18px;
                border-radius: 18px;
            }
            
            .message-text {
                font-size: 15px;
            }
            
            .input-container {
                padding: 16px;
                gap: 12px;
            }
            
            .send-button {
                width: 44px;
                height: 44px;
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 12px 0;
            }
            
            .logo-container {
                gap: 10px;
            }
            
            .logo-text {
                font-size: 20px;
            }
            
            .logo-icon {
                width: 32px;
                height: 32px;
                font-size: 16px;
            }
            
            .tagline {
                font-size: 12px;
            }
            
            .container {
                padding: 90px 10px 20px;
            }
            
            .chat-container {
                padding: 16px;
                border-radius: 18px;
            }
            
            .welcome-banner {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .welcome-title {
                font-size: 18px;
            }
            
            .welcome-subtitle {
                font-size: 14px;
            }
            
            .message {
                max-width: 95%;
                gap: 10px;
            }
            
            .message-avatar {
                width: 36px;
                height: 36px;
                font-size: 14px;
            }
            
            .message-content {
                padding: 14px 16px;
                border-radius: 16px;
            }
            
            .message-text {
                font-size: 14px;
            }
            
            .message-time {
                font-size: 11px;
            }
            
            .input-container {
                padding: 14px;
                border-radius: 16px;
            }
            
            .message-input {
                font-size: 15px;
            }
            
            .send-button {
                width: 40px;
                height: 40px;
                font-size: 15px;
            }
            
            .footer {
                font-size: 12px;
                padding: 15px;
            }
        }

        /* Loading States */
        .loading-shimmer {
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.05) 25%,
                rgba(255, 255, 255, 0.1) 50%,
                rgba(255, 255, 255, 0.05) 75%
            );
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: slideInRight 0.3s ease;
            background: rgba(20, 20, 30, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        .status-dot.disconnected {
            background: #f44336;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div>
                    <div class="logo-text">Arora AI</div>
                    <div class="tagline">Intelligent Assistant powered by AI</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <main class="container">
        <!-- Chat Container -->
        <div class="chat-container">
            <!-- Welcome Banner -->
            <div class="welcome-banner">
                <div class="welcome-title">Welcome to Arora AI</div>
                <div class="welcome-subtitle">Ask me anything - I'm here to help with knowledge, creativity, and problem-solving</div>
            </div>

            <!-- Messages Area -->
            <div class="messages-area" id="messagesArea">
                <!-- Messages will be added here -->
            </div>

            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <span style="margin-left: 10px; color: rgba(255,255,255,0.7); font-size: 14px;">Arora AI is thinking...</span>
            </div>

            <!-- Input Area -->
            <div class="input-container">
                <textarea 
                    class="message-input" 
                    id="messageInput" 
                    placeholder="Type your message here... (Shift+Enter for new line)"
                    rows="1"
                    autocomplete="off"
                    autocorrect="off"
                    autocapitalize="off"
                    spellcheck="true"
                ></textarea>
                <button class="send-button" id="sendButton" title="Send message">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Powered by Puter.js AI â€¢ Real-time streaming responses â€¢ Secure & Private</p>
        </div>
    </main>

    <!-- Connection Status -->
    <div class="connection-status" id="connectionStatus">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">Connected to AI</span>
    </div>

    <!-- Puter.js SDK -->
    <script src="https://js.puter.com/v2/"></script>

    <script>
        // DOM Elements
        const messagesArea = document.getElementById('messagesArea');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const connectionStatus = document.getElementById('connectionStatus');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');

        // Chat configuration
        const AI_MODEL = 'gpt-4.1-nano'; // Using GPT-4.1 Nano model
        let isConnected = false;
        let isProcessing = false;
        let messageQueue = [];

        // Initialize chat
        document.addEventListener('DOMContentLoaded', () => {
            initChat();
            testAIConnection();
        });

        // Test AI connection
        async function testAIConnection() {
            try {
                updateConnectionStatus('Connecting to AI...', 'connecting');
                
                // Test with a simple request
                await puter.ai.chat('Hello', { model: AI_MODEL, stream: false });
                
                updateConnectionStatus('Connected to AI', 'connected');
                isConnected = true;
                
                // Add welcome message
                setTimeout(() => {
                    addWelcomeMessage();
                }, 500);
                
            } catch (error) {
                console.error('AI Connection Error:', error);
                updateConnectionStatus('AI Service Unavailable', 'disconnected');
                isConnected = false;
                
                // Show error message
                showErrorMessage('Unable to connect to AI service. Please refresh the page or try again later.');
            }
        }

        // Update connection status
        function updateConnectionStatus(text, status) {
            statusText.textContent = text;
            statusDot.className = 'status-dot ' + status;
            
            if (status === 'connected') {
                connectionStatus.style.borderColor = 'rgba(76, 175, 80, 0.3)';
            } else if (status === 'disconnected') {
                connectionStatus.style.borderColor = 'rgba(244, 67, 54, 0.3)';
            } else {
                connectionStatus.style.borderColor = 'rgba(255, 193, 7, 0.3)';
            }
        }

        // Add welcome message
        function addWelcomeMessage() {
            const welcomeMessages = [
                "Hello! I'm Arora AI, your intelligent assistant. I'm powered by advanced AI models and ready to help you with any questions or tasks you have.",
                "Hi there! ðŸ‘‹ I'm Arora AI. Whether you need help with research, creative writing, coding, or just want to chat, I'm here for you!",
                "Welcome to Arora AI! I can help you with a wide range of topics including learning, problem-solving, content creation, and more. What would you like to explore today?"
            ];
            
            const message = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
            addMessage(message, false, true);
        }

        // Show error message
        function showErrorMessage(message) {
            addMessage(`âš ï¸ ${message} Please try again later.`, false);
        }

        // Initialize chat
        function initChat() {
            // Auto-resize textarea
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            // Send message on Enter (Shift+Enter for new line)
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    if (!isProcessing) {
                        sendMessage();
                    }
                }
            });

            // Send button click
            sendButton.addEventListener('click', function() {
                if (!isProcessing) {
                    sendMessage();
                }
            });

            // Focus input
            setTimeout(() => {
                messageInput.focus();
            }, 1000);
        }

        // Send message
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || isProcessing) return;

            // Disable input and button
            messageInput.disabled = true;
            sendButton.disabled = true;
            isProcessing = true;

            // Add user message
            addMessage(message, true);

            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';

            // Show typing indicator
            typingIndicator.classList.add('active');

            try {
                // Get AI response
                await getAIResponseStream(message);
            } catch (error) {
                console.error('Error getting AI response:', error);
                typingIndicator.classList.remove('active');
                
                // Show error
                addMessage(`I apologize, but I encountered an error: ${error.message}. Please try again.`, false);
                
                // Re-enable input
                messageInput.disabled = false;
                sendButton.disabled = false;
                isProcessing = false;
                messageInput.focus();
            }
        }

        // Get AI response with streaming
        async function getAIResponseStream(prompt) {
            if (!isConnected) {
                throw new Error('Not connected to AI service');
            }

            // Create AI message container
            const messageId = Date.now().toString();
            const messageDiv = createMessageContainer('', false, messageId);
            messagesArea.appendChild(messageDiv);

            let fullResponse = '';
            let isFirstChunk = true;

            try {
                // Stream from AI
                const response = await puter.ai.chat(prompt, { 
                    model: AI_MODEL, 
                    stream: true,
                    temperature: 0.7,
                    max_tokens: 2000
                });

                // Process stream
                for await (const part of response) {
                    if (part?.text) {
                        if (isFirstChunk) {
                            // Hide typing indicator when we start receiving
                            typingIndicator.classList.remove('active');
                            isFirstChunk = false;
                        }
                        
                        fullResponse += part.text;
                        updateMessageContent(messageId, fullResponse);
                    }
                }

                // Add timestamp when done
                if (!isFirstChunk) {
                    addMessageTime(messageId);
                }

            } catch (error) {
                console.error('Streaming error:', error);
                
                // Remove the empty message container if there was an error
                if (isFirstChunk) {
                    messageDiv.remove();
                    typingIndicator.classList.remove('active');
                    throw error;
                } else {
                    // Update with error message
                    updateMessageContent(messageId, fullResponse + '\n\nâš ï¸ Response was cut short due to an error.');
                }
            } finally {
                // Re-enable input
                messageInput.disabled = false;
                sendButton.disabled = false;
                isProcessing = false;
                messageInput.focus();

                // Scroll to bottom
                setTimeout(() => {
                    messagesArea.scrollTop = messagesArea.scrollHeight;
                }, 100);
            }
        }

        // Create message container
        function createMessageContainer(text, isUser, id = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
            if (id) messageDiv.id = `msg-${id}`;
            
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const avatarIcon = isUser ? 'fa-user' : 'fa-robot';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas ${avatarIcon}"></i>
                </div>
                <div class="message-content">
                    <div class="message-text" id="text-${id || 'temp'}">${text.replace(/\n/g, '<br>')}</div>
                    ${isUser ? `<div class="message-time">${time}</div>` : ''}
                </div>
            `;
            
            return messageDiv;
        }

        // Add message
        function addMessage(text, isUser, isWelcome = false) {
            const messageDiv = createMessageContainer(text, isUser);
            
            if (!isWelcome) {
                messageDiv.style.animationDelay = '0s';
            }
            
            messagesArea.appendChild(messageDiv);
            
            // Scroll to bottom
            setTimeout(() => {
                messagesArea.scrollTop = messagesArea.scrollHeight;
                messageDiv.style.opacity = '1';
                messageDiv.style.transform = isUser ? 'translateX(0)' : 'translateX(0)';
            }, 10);
            
            return messageDiv;
        }

        // Update message content
        function updateMessageContent(messageId, text) {
            const textElement = document.getElementById(`text-${messageId}`);
            if (textElement) {
                textElement.innerHTML = text.replace(/\n/g, '<br>');
                
                // Scroll to keep visible
                const messageDiv = document.getElementById(`msg-${messageId}`);
                if (messageDiv) {
                    messageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
                }
            }
        }

        // Add timestamp to AI message
        function addMessageTime(messageId) {
            const messageDiv = document.getElementById(`msg-${messageId}`);
            if (messageDiv) {
                const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const timeElement = document.createElement('div');
                timeElement.className = 'message-time';
                timeElement.textContent = time;
                
                const contentDiv = messageDiv.querySelector('.message-content');
                if (contentDiv) {
                    contentDiv.appendChild(timeElement);
                }
            }
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            messageInput.style.height = 'auto';
            messageInput.style.height = (messageInput.scrollHeight) + 'px';
        });

        // Handle page visibility
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                messageInput.focus();
            }
        });

        // Prevent form submission
        document.addEventListener('submit', (e) => {
            e.preventDefault();
        });
    </script>
</body>
</html>
